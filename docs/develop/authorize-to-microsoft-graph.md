---
title: Autorizar o Microsoft Graph com SSO
description: Saiba como os usuários de um suplemento do Office podem usar o logon único (SSO) para buscar dados do Microsoft Graph.
ms.date: 07/30/2020
localization_priority: Normal
ms.openlocfilehash: 81e8a87c21682a76c73e5e7389e85cd4f20c6a1d
ms.sourcegitcommit: 8fdd7369bfd97a273e222a0404e337ba2b8807b0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/05/2020
ms.locfileid: "46573172"
---
# <a name="authorize-to-microsoft-graph-with-sso"></a><span data-ttu-id="1df26-103">Autorizar o Microsoft Graph com SSO</span><span class="sxs-lookup"><span data-stu-id="1df26-103">Authorize to Microsoft Graph with SSO</span></span>

<span data-ttu-id="1df26-104">Os usuários entram no Office (plataformas online, de dispositivos móveis e de área de trabalho) usando contas pessoais da Microsoft, contas corporativas ou do Microsoft 365 Education.</span><span class="sxs-lookup"><span data-stu-id="1df26-104">Users sign in to Office (online, mobile, and desktop platforms) using either their personal Microsoft account or their Microsoft 365 Education or work account.</span></span> <span data-ttu-id="1df26-105">A melhor maneira de um Suplemento do Office receber acesso autorizado ao [Microsoft Graph](https://developer.microsoft.com/graph/docs) é usar as credenciais de logon do Office do usuário.</span><span class="sxs-lookup"><span data-stu-id="1df26-105">The best way for an Office Add-in to get authorized access to [Microsoft Graph](https://developer.microsoft.com/graph/docs) is to use the credentials from the user's Office sign on.</span></span> <span data-ttu-id="1df26-106">Isso permite a eles acessar seus dados do Microsoft Graph sem precisar entrar novamente.</span><span class="sxs-lookup"><span data-stu-id="1df26-106">This enables them to access their Microsoft Graph data without needing to sign in a second time.</span></span>

> [!NOTE]
> <span data-ttu-id="1df26-107">Atualmente, a API de logon único tem suporte para Word, Excel, Outlook e PowerPoint.</span><span class="sxs-lookup"><span data-stu-id="1df26-107">The Single Sign-on API is currently supported for Word, Excel, Outlook, and PowerPoint.</span></span> <span data-ttu-id="1df26-108">Confira mais informações sobre os programas para os quais a API de logon único tem suporte no momento em [Conjuntos de requisitos da IdentityAPI](/office/dev/add-ins/reference/requirement-sets/identity-api-requirement-sets).</span><span class="sxs-lookup"><span data-stu-id="1df26-108">For more information about where the Single Sign-on API is currently supported, see [IdentityAPI requirement sets](/office/dev/add-ins/reference/requirement-sets/identity-api-requirement-sets).</span></span>
> <span data-ttu-id="1df26-109">Se você estiver trabalhando com um suplemento do Outlook, certifique-se de habilitar a Autenticação Moderna para a locação do Office 365.</span><span class="sxs-lookup"><span data-stu-id="1df26-109">If you are working with an Outlook add-in, be sure to enable Modern Authentication for the Office 365 tenancy.</span></span> <span data-ttu-id="1df26-110">Confira mais informações sobre como fazer isso em [Exchange Online: como habilitar seu locatário para autenticação moderna](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span><span class="sxs-lookup"><span data-stu-id="1df26-110">For information about how to do this, see [Exchange Online: How to enable your tenant for modern authentication](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span></span>


## <a name="add-in-architecture-for-sso-and-microsoft-graph"></a><span data-ttu-id="1df26-111">Arquitetura de suplemento para SSO e Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="1df26-111">Add-in architecture for SSO and Microsoft Graph</span></span>

<span data-ttu-id="1df26-112">Além de hospedar as páginas e o JavaScript do aplicativo web, o suplemento também deve hospedar, ao mesmo tempo o [nome de domínio totalmente qualificado](/windows/desktop/DNS/f-gly#_dns_fully_qualified_domain_name_fqdn__gly), uma ou mais APIs web que obterá um token de acesso ao Microsoft Graph e fará solicitações a ele.</span><span class="sxs-lookup"><span data-stu-id="1df26-112">In addition to hosting the pages and JavaScript of the web application, the add-in must also host, at the same [fully qualified domain name](/windows/desktop/DNS/f-gly#_dns_fully_qualified_domain_name_fqdn__gly), one or more web APIs that will get an access token to Microsoft Graph and make requests to it.</span></span>

<span data-ttu-id="1df26-113">O manifesto do suplemento contém a marcação que especifica como ele está registrado no ponto de extremidade v2.0 do Azure Active Directory (Azure AD) e especifica todas as permissões para o Microsoft Graph que o suplemento precisa.</span><span class="sxs-lookup"><span data-stu-id="1df26-113">The add-in manifest contains markup that specifies how the add-in is registered in the Azure Active Directory (Azure AD) v2.0 endpoint, and it specifies any permissions to Microsoft Graph that the add-in needs.</span></span>

### <a name="how-it-works-at-runtime"></a><span data-ttu-id="1df26-114">Como ele funciona em tempo de execução</span><span class="sxs-lookup"><span data-stu-id="1df26-114">How it works at runtime</span></span>

<span data-ttu-id="1df26-115">O diagrama a seguir mostra como funciona o processo de entrar e obter acesso ao Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="1df26-115">The following diagram shows how the process of signing in and getting access to Microsoft Graph works.</span></span>

![Diagrama que mostra o processo de SSO](../images/sso-access-to-microsoft-graph.png)

1. <span data-ttu-id="1df26-117">No suplemento, o JavaScript chama uma nova API do Office.js [getAccessToken](/javascript/api/office-runtime/officeruntime.auth#getaccesstoken-options-).</span><span class="sxs-lookup"><span data-stu-id="1df26-117">In the add-in, JavaScript calls a new Office.js API [getAccessToken](/javascript/api/office-runtime/officeruntime.auth#getaccesstoken-options-).</span></span> <span data-ttu-id="1df26-118">Isso informa ao aplicativo host do Office para obter um token de acesso para o suplemento.</span><span class="sxs-lookup"><span data-stu-id="1df26-118">This tells the Office host application to obtain an access token to the add-in.</span></span> <span data-ttu-id="1df26-119">(De agora em diante, isso se chamará **token de acesso de inicialização** porque é substituído por um segundo token mais tarde durante o processo.</span><span class="sxs-lookup"><span data-stu-id="1df26-119">(Hereafter, this is called the **bootstrap access token** because it is replaced with a second token later in the process.</span></span> <span data-ttu-id="1df26-120">Para ver um exemplo de um token de acesso de inicialização decodificado, confira [Token de acesso de exemplo](sso-in-office-add-ins.md#example-access-token).)</span><span class="sxs-lookup"><span data-stu-id="1df26-120">For an example of a decoded bootstrap access token, see [Example access token](sso-in-office-add-ins.md#example-access-token).)</span></span>
2. <span data-ttu-id="1df26-121">Se o usuário não estiver conectado, o aplicativo host do Office abrirá uma janela pop-up para o usuário entrar.</span><span class="sxs-lookup"><span data-stu-id="1df26-121">If the user is not signed in, the Office host application opens a pop-up window for the user to sign in.</span></span>
3. <span data-ttu-id="1df26-122">Se essa é a primeira vez que o usuário atual usa seu suplemento, será solicitado que ele dê o consentimento.</span><span class="sxs-lookup"><span data-stu-id="1df26-122">If this is the first time the current user has used your add-in, he or she is prompted to consent.</span></span>
4. <span data-ttu-id="1df26-123">O aplicativo host do Office solicita o **token de acesso de inicialização** do ponto de extremidade v2.0 do Azure AD para o usuário atual.</span><span class="sxs-lookup"><span data-stu-id="1df26-123">The Office host application requests the **bootstrap access token** from the Azure AD v2.0 endpoint for the current user.</span></span>
5. <span data-ttu-id="1df26-124">O Azure AD envia o token de inicialização para o aplicativo host do Office.</span><span class="sxs-lookup"><span data-stu-id="1df26-124">Azure AD sends the bootstrap token to the Office host application.</span></span>
6. <span data-ttu-id="1df26-125">O aplicativo host do Office envia o **token de acesso de inicialização** ao suplemento como parte do objeto de resultado retornado pela chamada de `getAccessToken`.</span><span class="sxs-lookup"><span data-stu-id="1df26-125">The Office host application sends the **bootstrap access token** to the add-in as part of the result object returned by the `getAccessToken` call.</span></span>
7. <span data-ttu-id="1df26-126">O JavaScript no suplemento faz uma solicitação HTTP a uma API Web que está hospedada no mesmo domínio totalmente qualificado que o suplemento e inclui o **token de acesso de inicialização** como prova de autorização.</span><span class="sxs-lookup"><span data-stu-id="1df26-126">JavaScript in the add-in makes an HTTP request to a web API that is hosted at the same fully-qualified domain as the add-in, and it includes the **bootstrap access token** as authorization proof.</span></span>
8. <span data-ttu-id="1df26-127">O código no lado do servidor valida o **token de acesso de inicialização** de entrada.</span><span class="sxs-lookup"><span data-stu-id="1df26-127">Server-side code validates the incoming **bootstrap access token**.</span></span>
9. <span data-ttu-id="1df26-128">O código do lado do servidor usa o fluxo "em nome de" (definido em [OAuth2 token Exchange](https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-02) e o [daemon ou aplicativo de servidor para o cenário da API Web do Azure](/azure/active-directory/develop/active-directory-authentication-scenarios)) para obter um token de acesso para o Microsoft Graph no Exchange para o token de acesso de inicialização.</span><span class="sxs-lookup"><span data-stu-id="1df26-128">Server-side code uses the "on behalf of" flow (defined at [OAuth2 Token Exchange](https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-02) and the [daemon or server application to web API Azure scenario](/azure/active-directory/develop/active-directory-authentication-scenarios)) to obtain an access token for Microsoft Graph in exchange for the bootstrap access token.</span></span>
10. <span data-ttu-id="1df26-129">O Azure AD retorna o token de acesso de inicialização para o Microsoft Graph (e um token de atualização, se o suplemento solicitar a permissão *offline_access*) para ele próprio.</span><span class="sxs-lookup"><span data-stu-id="1df26-129">Azure AD returns the access token to Microsoft Graph (and a refresh token, if the add-in requests *offline_access* permission) to the add-in.</span></span>
11. <span data-ttu-id="1df26-130">O código do lado do servidor armazena em cache o token de acesso ao Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="1df26-130">Server-side code caches the access token to Microsoft Graph.</span></span>
12. <span data-ttu-id="1df26-131">O código do lado do servidor faz solicitações ao Microsoft Graph e inclui o token de acesso ao Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="1df26-131">Server-side code makes requests to Microsoft Graph and includes the access token to Microsoft Graph.</span></span>
13. <span data-ttu-id="1df26-132">O Microsoft Graph retorna dados para o suplemento, que pode passá-los para a interface do usuário do suplemento.</span><span class="sxs-lookup"><span data-stu-id="1df26-132">Microsoft Graph returns data to the add-in, which can pass it on to the add-in's UI.</span></span>
14. <span data-ttu-id="1df26-133">Quando o token de acesso ao Microsoft Graph expira, o código do lado do servidor pode usar o token de atualização para obter um novo token de acesso ao Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="1df26-133">When the access token to Microsoft Graph expires, the server-side code can use its refresh token to get a new access token to Microsoft Graph.</span></span>

## <a name="develop-an-sso-add-in-that-accesses-microsoft-graph"></a><span data-ttu-id="1df26-134">Desenvolver um suplemento SSO que acessa o Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="1df26-134">Develop an SSO add-in that accesses Microsoft Graph</span></span>

<span data-ttu-id="1df26-135">Você desenvolve um suplemento que acessa o Microsoft Graph como faria com qualquer outro suplemento que use SSO.</span><span class="sxs-lookup"><span data-stu-id="1df26-135">You develop an add-in that accesses Microsoft Graph just as you would any other add-in that uses SSO.</span></span> <span data-ttu-id="1df26-136">Para obter uma descrição completa, confira [Habilitar o logon único para Suplementos do Office](../develop/sso-in-office-add-ins.md). A diferença é que é obrigatório que o suplemento tenha uma API Web do lado do servidor, e o token de acesso nesse artigo é chamado de "token de acesso de inicialização".</span><span class="sxs-lookup"><span data-stu-id="1df26-136">For a thorough description, see [Enable single sign-on for Office Add-ins](../develop/sso-in-office-add-ins.md). The difference is that it is mandatory that the add-in have a server-side Web API, and what's called the access token in that article is called the "bootstrap access token."</span></span>

<span data-ttu-id="1df26-137">Dependendo do seu idioma e da estrutura, podem estar disponíveis bibliotecas que simplificarão o código do lado do servidor que você precisa escrever.</span><span class="sxs-lookup"><span data-stu-id="1df26-137">Depending on your language and framework, libraries might be available that will simplify the server-side code you have to write.</span></span> <span data-ttu-id="1df26-138">O código deve fazer o seguinte:</span><span class="sxs-lookup"><span data-stu-id="1df26-138">Your code should do the following:</span></span>

* <span data-ttu-id="1df26-139">Inicie o fluxo "em nome de" com uma chamada para o ponto de extremidade do Azure AD v 2.0 que inclui o token de acesso de inicialização, alguns metadados sobre o usuário e as credenciais do suplemento (ID e segredo).</span><span class="sxs-lookup"><span data-stu-id="1df26-139">Initiate the "on behalf of" flow with a call to the Azure AD v2.0 endpoint that includes the bootstrap access token, some metadata about the user, and the credentials of the add-in (its ID and secret).</span></span>
* <span data-ttu-id="1df26-140">Crie um ou mais métodos de API Web que obtêm dados do Microsoft Graph passando o token de acesso (possivelmente em cache) para o Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="1df26-140">Create one or more Web API methods that get Microsoft Graph data by passing the (possibly cached) access token to Microsoft Graph.</span></span>
* <span data-ttu-id="1df26-141">Opcionalmente, antes de iniciar o fluxo, valide o token de acesso de inicialização que é recebido do manipulador de token que você criou anteriormente.</span><span class="sxs-lookup"><span data-stu-id="1df26-141">Optionally, before initiating the flow, validate the add-in bootstrap access token that is received from the token handler you created earlier.</span></span> <span data-ttu-id="1df26-142">Para saber mais, confira [Validar o token de acesso](sso-in-office-add-ins.md#validate-the-access-token).</span><span class="sxs-lookup"><span data-stu-id="1df26-142">For more information, see [Validate the access token](sso-in-office-add-ins.md#validate-the-access-token).</span></span> 
* <span data-ttu-id="1df26-143">Opcionalmente, após concluir o fluxo, armazene em cache o token de acesso retornado no Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="1df26-143">Optionally, after the flow completes, cache the returned access token to Microsoft Graph.</span></span> <span data-ttu-id="1df26-144">Faça isso se o suplemento fizer mais de uma chamada para o Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="1df26-144">You'll want to do this if the add-in makes more than one call to Microsoft Graph.</span></span> <span data-ttu-id="1df26-145">Para mais informações sobre esse fluxo, confira [Azure Active Directory v2.0 e fluxo "On-Behalf-Of" do OAuth 2.0](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span><span class="sxs-lookup"><span data-stu-id="1df26-145">For more information about this flow see [Azure Active Directory v2.0 and OAuth 2.0 On-Behalf-Of flow](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span></span>

> [!NOTE]
> <span data-ttu-id="1df26-146">Para exemplos de tokens de acesso decodificados do Microsoft Graph obtidos pelo fluxo "on behalf of", confira [Azure Active Directory v2.0 e fluxo "On-Behalf-Of" do OAuth 2.0](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span><span class="sxs-lookup"><span data-stu-id="1df26-146">For examples of decoded access tokens for Microsoft Graph that have been obtained by the "on-behalf-of" flow, see [Azure Active Directory v2.0 and OAuth 2.0 On-Behalf-Of flow](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span></span>

<span data-ttu-id="1df26-147">Para obter exemplos detalhados passo a passo de cenários, confira:</span><span class="sxs-lookup"><span data-stu-id="1df26-147">For examples of detailed walkthroughs and scenarios, see:</span></span>

* [<span data-ttu-id="1df26-148">Criar um Suplemento do Office com Node.js que usa logon único</span><span class="sxs-lookup"><span data-stu-id="1df26-148">Create a Node.js Office Add-in that uses single sign-on</span></span>](create-sso-office-add-ins-nodejs.md)
* [<span data-ttu-id="1df26-149">Criar um Suplemento do Office com ASP.NET que usa logon único</span><span class="sxs-lookup"><span data-stu-id="1df26-149">Create an ASP.NET Office Add-in that uses single sign-on</span></span>](create-sso-office-add-ins-aspnet.md)
* [<span data-ttu-id="1df26-150">Cenário: implementar o logon único no serviço em um suplemento do Outlook</span><span class="sxs-lookup"><span data-stu-id="1df26-150">Scenario: Implement single sign-on to your service in an Outlook add-in</span></span>](../outlook/implement-sso-in-outlook-add-in.md)

## <a name="distributing-sso-enabled-add-ins-in-microsoft-appsource"></a><span data-ttu-id="1df26-151">Distribuindo suplementos habilitados para SSO no Microsoft AppSource</span><span class="sxs-lookup"><span data-stu-id="1df26-151">Distributing SSO-enabled add-ins in Microsoft AppSource</span></span>

<span data-ttu-id="1df26-152">Quando um administrador do Microsoft 365 adquire um suplemento do [AppSource](https://appsource.microsoft.com), o administrador pode redistribuí-lo pela [implantação centralizada](../publish/centralized-deployment.md) e conceder consentimento do administrador ao suplemento para acessar escopos do Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="1df26-152">When a Microsoft 365 admin acquires an add-in from [AppSource](https://appsource.microsoft.com), the admin can redistribute it by [centralized deployment](../publish/centralized-deployment.md) and grant admin consent to the add-in to access Microsoft Graph scopes.</span></span> <span data-ttu-id="1df26-153">Também é possível, no entanto, que o usuário final adquira o suplemento diretamente de AppSource, caso em que o usuário deve conceder consentimento ao suplemento.</span><span class="sxs-lookup"><span data-stu-id="1df26-153">It's also possible, however, for the end user to acquire the add-in directly from AppSource, in which case the user must grant consent to the add-in.</span></span> <span data-ttu-id="1df26-154">Isso pode criar um possível problema de desempenho para o qual fornecemos uma solução.</span><span class="sxs-lookup"><span data-stu-id="1df26-154">This can create a potential performance problem for which we've provided a solution.</span></span>

<span data-ttu-id="1df26-155">Se seu código passar a `allowConsentPrompt` opção na chamada de `getAccessToken` , like `OfficeRuntime.auth.getAccessToken( { allowConsentPrompt: true } );` , o Office poderá solicitar o consentimento do usuário se o Azure ad reportar ao Office que o consentimento ainda não foi concedido ao suplemento.</span><span class="sxs-lookup"><span data-stu-id="1df26-155">If your code passes the `allowConsentPrompt` option in the call of `getAccessToken`, like `OfficeRuntime.auth.getAccessToken( { allowConsentPrompt: true } );`, then Office can prompt the user for consent if Azure AD reports to Office that consent has not yet been granted to the add-in.</span></span> <span data-ttu-id="1df26-156">No entanto, por motivos de segurança, o Office só pode solicitar que o usuário concorde com o escopo do Azure AD `profile` .</span><span class="sxs-lookup"><span data-stu-id="1df26-156">However, for security reasons, Office can only prompt the user to consent to the Azure AD `profile` scope.</span></span> <span data-ttu-id="1df26-157">*O Office não pode solicitar o consentimento para os escopos do Microsoft Graph*, nem mesmo `User.Read` .</span><span class="sxs-lookup"><span data-stu-id="1df26-157">*Office cannot prompt for consent to any Microsoft Graph scopes*, not even `User.Read`.</span></span> <span data-ttu-id="1df26-158">Isso significa que, se o usuário conceder consentimento no prompt, o Office retornará um token de inicialização.</span><span class="sxs-lookup"><span data-stu-id="1df26-158">This means that if the user grants consent on the prompt, Office will return a bootstrap token.</span></span> <span data-ttu-id="1df26-159">Mas a tentativa de trocar o token de inicialização para um token de acesso ao Microsoft Graph falhará com o erro AADSTS65001, o que significa que o consentimento (para escopos do Microsoft Graph) não foi concedido.</span><span class="sxs-lookup"><span data-stu-id="1df26-159">But the attempt to exchange the bootstrap token for an access token to Microsoft Graph will fail with error AADSTS65001, which means consent (to Microsoft Graph scopes) has not been granted.</span></span>

<span data-ttu-id="1df26-160">Seu código pode e deve lidar com esse erro recorrendo a um sistema alternativo de autenticação, o que solicitará o consentimento do usuário aos escopos do Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="1df26-160">Your code can, and should, handle this error by falling back to an alternate system of authentication, which will prompt the user for consent to Microsoft Graph scopes.</span></span> <span data-ttu-id="1df26-161">(Para obter exemplos de código, confira [criar um Node.js suplemento do Office que usa o logon único](create-sso-office-add-ins-nodejs.md) e [criar um suplemento do Office do ASP.NET que usa o logon único](create-sso-office-add-ins-aspnet.md) e os exemplos aos quais eles se vinculam.) Mas todo o processo requer vários tempos de viagem para o Azure AD.</span><span class="sxs-lookup"><span data-stu-id="1df26-161">(For code examples, see [Create a Node.js Office Add-in that uses single sign-on](create-sso-office-add-ins-nodejs.md) and [Create an ASP.NET Office Add-in that uses single sign-on](create-sso-office-add-ins-aspnet.md) and the samples they link to.) But the entire process requires multiple round trips to Azure AD.</span></span> <span data-ttu-id="1df26-162">Você pode evitar essa penalidade de desempenho, incluindo a `forMSGraphAccess` opção na chamada de `getAccessToken` ; por exemplo, `OfficeRuntime.auth.getAccessToken( { forMSGraphAccess: true } )` .</span><span class="sxs-lookup"><span data-stu-id="1df26-162">You can avoid this performance penalty by including the `forMSGraphAccess` option in the call of `getAccessToken`; for example, `OfficeRuntime.auth.getAccessToken( { forMSGraphAccess: true } )`.</span></span>  <span data-ttu-id="1df26-163">Isso indica ao Office que seu suplemento precisa de escopos do Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="1df26-163">This signals to Office that your add-in needs Microsoft Graph scopes.</span></span> <span data-ttu-id="1df26-164">O Office solicitará que o Azure AD Verifique se o consentimento para os escopos do Microsoft Graph já foi concedido ao suplemento.</span><span class="sxs-lookup"><span data-stu-id="1df26-164">Office will ask Azure AD to verify that consent to Microsoft Graph scopes has already been granted to the add-in.</span></span> <span data-ttu-id="1df26-165">Se tiver sido, o token Bootstrap será retornado.</span><span class="sxs-lookup"><span data-stu-id="1df26-165">If it has, the bootstrap token will be returned.</span></span> <span data-ttu-id="1df26-166">Se não tiver, a chamada de retornará o `getAccessToken` erro 13012.</span><span class="sxs-lookup"><span data-stu-id="1df26-166">If it hasn't, then the call of `getAccessToken` will return error 13012.</span></span> <span data-ttu-id="1df26-167">Seu código pode lidar com esse erro recorrendo a um sistema alternativo de autenticação imediatamente, sem fazer uma tentativa de Doomed para trocar tokens com o Azure AD.</span><span class="sxs-lookup"><span data-stu-id="1df26-167">Your code can handle this error by falling back to an alternate system of authentication immediately, without making a doomed attempt to exchange tokens with Azure AD.</span></span>

<span data-ttu-id="1df26-168">Como prática recomendada, sempre passe `forMSGraphAccess` para `getAccessToken` quando o suplemento for distribuído no AppSource e precise de escopos do Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="1df26-168">As a best practice, always pass `forMSGraphAccess` to `getAccessToken` when your add-in will be distributed in AppSource and needs Microsoft Graph scopes.</span></span>

> [!TIP]
> <span data-ttu-id="1df26-169">Se você desenvolver um suplemento do Outlook que usa SSO e Sideload-lo para teste, o Office *sempre* retornará o erro 13012 quando `forMSGraphAccess` for passado para `getAccessToken` mesmo se o consentimento do administrador tiver sido concedido.</span><span class="sxs-lookup"><span data-stu-id="1df26-169">If you develop an Outlook add-in that uses SSO and you sideload it for testing, Office will *always* return error 13012 when `forMSGraphAccess` is passed to `getAccessToken` even if administrator consent has been granted.</span></span> <span data-ttu-id="1df26-170">Por esse motivo, você deve comentar a `forMSGraphAccess` opção **ao desenvolver** um suplemento do Outlook.</span><span class="sxs-lookup"><span data-stu-id="1df26-170">For this reason, you should comment out the `forMSGraphAccess` option **when developing** an Outlook add-in.</span></span> <span data-ttu-id="1df26-171">Certifique-se de remover o comentário da opção ao implantar para produção.</span><span class="sxs-lookup"><span data-stu-id="1df26-171">Be sure to uncomment the option when you deploy for production.</span></span> <span data-ttu-id="1df26-172">O 13012 falso só acontece quando você está Sideload no Outlook.</span><span class="sxs-lookup"><span data-stu-id="1df26-172">The bogus 13012 only happens when you are sideloading in Outlook.</span></span>
