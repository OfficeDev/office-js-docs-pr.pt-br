---
title: Autenticar e autorizar com a API da Caixa de Diálogo do Office
description: ''
ms.date: 12/06/2019
localization_priority: Priority
ms.openlocfilehash: 7c8e012c2ef74e8a8e92203817b4f5f2eb60bd01
ms.sourcegitcommit: 8c5c5a1bd3fe8b90f6253d9850e9352ed0b283ee
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/19/2019
ms.locfileid: "40814023"
---
# <a name="authenticate-and-authorize-with-the-office-dialog-api"></a><span data-ttu-id="86e9b-102">Autenticar e autorizar com a API da Caixa de Diálogo do Office</span><span class="sxs-lookup"><span data-stu-id="86e9b-102">Authenticate and authorize with the Office Dialog API</span></span>

> [!NOTE]
> <span data-ttu-id="86e9b-103">Esse artigo presume que você esteja familiarizado com o [Uso da API da Caixa de Diálogo nos suplementos do Office.](dialog-api-in-office-add-ins.md).</span><span class="sxs-lookup"><span data-stu-id="86e9b-103">This article assumes that you are familiar with [Use the Dialog API in your Office Add-ins](dialog-api-in-office-add-ins.md).</span></span>

<span data-ttu-id="86e9b-104">Várias autoridades de identidade, também chamadas de Serviços de Token Seguro (STS), impedem que a página de logon seja aberta em um IFrame.</span><span class="sxs-lookup"><span data-stu-id="86e9b-104">Many identity authorities, also called Secure Token Services (STS), prevent their login page from opening in an iframe.</span></span> <span data-ttu-id="86e9b-105">Elas incluem o Google, o Facebook e os serviços protegidos pela Plataforma de Identidade da Microsoft (antigo Azure AD V 2.0), como a Conta da Microsoft e o Office 365 (contas corporativas ou de estudante).</span><span class="sxs-lookup"><span data-stu-id="86e9b-105">These include Google, Facebook, and services protected by Microsoft Identity Platform (formerly Azure AD V 2.0) such as Microsoft Account and Office 365 (Work or School accounts).</span></span> <span data-ttu-id="86e9b-106">Isso cria um problema para os suplementos do Office, porque quando o suplemento é executado no **Office na Web**, o painel de tarefas é um IFrame.</span><span class="sxs-lookup"><span data-stu-id="86e9b-106">This creates a problem for Office Add-ins because when the add-in is running in **Office on the web**, the task pane is an iframe.</span></span> <span data-ttu-id="86e9b-107">Os usuários de um suplemento só podem fazer logon em um desses serviços se o suplemento puder abrir uma instância do navegador completamente separada.</span><span class="sxs-lookup"><span data-stu-id="86e9b-107">Users of an add-in can only login to one of these services if the add-in can open an entirely separate browser instance.</span></span> <span data-ttu-id="86e9b-108">Esse é o motivo pelo qual o Office fornece a [API da Caixa de Diálogo](dialog-api-in-office-add-ins.md), especificamente o método [displayDialogAsync](/javascript/api/office/office.ui).</span><span class="sxs-lookup"><span data-stu-id="86e9b-108">This is why Office provides its [Dialog API](dialog-api-in-office-add-ins.md), specifically the [displayDialogAsync](/javascript/api/office/office.ui) method.</span></span>

<span data-ttu-id="86e9b-109">A caixa de diálogo que é aberta com essa API tem as seguintes características:</span><span class="sxs-lookup"><span data-stu-id="86e9b-109">The dialog box that is opened with this API has the following characteristics:</span></span>

- <span data-ttu-id="86e9b-110">Ela é [não modal](https://en.wikipedia.org/wiki/Dialog_box).</span><span class="sxs-lookup"><span data-stu-id="86e9b-110">It is [non-modal](https://en.wikipedia.org/wiki/Dialog_box).</span></span>
- <span data-ttu-id="86e9b-111">É uma instância do navegador completamente separada do painel de tarefas, ou seja:</span><span class="sxs-lookup"><span data-stu-id="86e9b-111">It is a completely separate browser instance from the task pane, meaning:</span></span>
  - <span data-ttu-id="86e9b-112">Tem o seu próprio ambiente de tempo de execução do JavaScript, objeto de janela e variáveis globais.</span><span class="sxs-lookup"><span data-stu-id="86e9b-112">It has its own JavaScript runtime environment and window object and global variables.</span></span>
  - <span data-ttu-id="86e9b-113">Não há nenhum ambiente de execução compartilhado com o painel de tarefas.</span><span class="sxs-lookup"><span data-stu-id="86e9b-113">There is no shared execution environment with the task pane.</span></span>
  - <span data-ttu-id="86e9b-114">Não compartilha o mesmo armazenamento de sessão que o painel de tarefas.</span><span class="sxs-lookup"><span data-stu-id="86e9b-114">It does not share the same session storage as the task pane.</span></span>
- <span data-ttu-id="86e9b-115">A primeira página aberta na caixa de diálogo deve estar hospedada no mesmo domínio que o painel de tarefas, incluindo o protocolo, os subdomínios e a porta, se houver.</span><span class="sxs-lookup"><span data-stu-id="86e9b-115">The first page opened in the dialog box must be hosted in the same domain as the task pane, including protocol, subdomains, and port, if any.</span></span>
- <span data-ttu-id="86e9b-116">A caixa de diálogo pode enviar informações de volta para o painel de tarefas usando o método [messageParent](/javascript/api/office/office.ui#messageparent-message-), porém esse método só pode ser chamado a partir de uma página hospedada no mesmo domínio que o painel de tarefas, incluindo o protocolo, os subdomínios e a porta.</span><span class="sxs-lookup"><span data-stu-id="86e9b-116">The dialog box can send information back to the task pane by using the [messageParent](/javascript/api/office/office.ui#messageparent-message-) method, but this method can be called only from a page that is hosted in the same domain as the task pane, including protocol, subdomains, and port.</span></span>

<span data-ttu-id="86e9b-117">Quando a caixa de diálogo não é um IFrame (que é o padrão), ela pode abrir a página de logon de um provedor de identidade.</span><span class="sxs-lookup"><span data-stu-id="86e9b-117">When the dialog is not an iframe (which is the default), it can open the login page of an identity provider.</span></span> <span data-ttu-id="86e9b-118">Como é mostrado a seguir, as características do Diálogo têm implicações sobre como você usa as bibliotecas de autenticação ou autorização, como a MSAL e o Passaporte. </span><span class="sxs-lookup"><span data-stu-id="86e9b-118">As you'll see below, the characteristics of the Dialog have implications for how you use authentication or authorization libraries such as MSAL and Passport.</span></span>

> [!NOTE]
> <span data-ttu-id="86e9b-119">Há uma maneira de configurar a caixa de diálogo para abrir em um IFrame flutuante: basta passar a opção `displayInIframe: true` na chamada do `displayDialogAsync`.</span><span class="sxs-lookup"><span data-stu-id="86e9b-119">There is a way to configure the dialog to open in a floating iframe: you simply pass the `displayInIframe: true` option in the call to `displayDialogAsync`.</span></span> <span data-ttu-id="86e9b-120">*Não* faça isso quando estiver usando a API da Caixa de Diálogo para logon.</span><span class="sxs-lookup"><span data-stu-id="86e9b-120">Do *not* do this when you are using the Dialog API for login.</span></span>

## <a name="authentication-flow-with-the-dialog"></a><span data-ttu-id="86e9b-121">Fluxo de autenticação pela Caixa de Diálogo</span><span class="sxs-lookup"><span data-stu-id="86e9b-121">Authentication flow with the Dialog</span></span>

<span data-ttu-id="86e9b-122">O que vem a seguir é um fluxo de autenticação simples e típico.</span><span class="sxs-lookup"><span data-stu-id="86e9b-122">The following is a simple and typical authentication flow.</span></span> <span data-ttu-id="86e9b-123">Os detalhes estão após o diagrama.</span><span class="sxs-lookup"><span data-stu-id="86e9b-123">Details are after the diagram.</span></span>

![Uma imagem mostrando a relação entre o painel de tarefas e os processos de navegador da caixa de diálogo.](../images/taskpane-dialog-processes.gif)

1. <span data-ttu-id="86e9b-125">A primeira página que é aberta na caixa de diálogo é uma página local (ou outro recurso) que está hospedada no domínio do suplemento; ou seja, o mesmo domínio da janela do painel de tarefas.</span><span class="sxs-lookup"><span data-stu-id="86e9b-125">The first page that opens in the dialog box is a page (or other resource) that is hosted in the add-in's domain; that is, the same domain as the task pane window.</span></span> <span data-ttu-id="86e9b-126">Essa página pode ter uma única interface de usuário que informa "Aguarde. Estamos redirecionando você para a página onde poderá entrar no *NOME-DO-PROVEDOR*."</span><span class="sxs-lookup"><span data-stu-id="86e9b-126">This page can have a simple UI that says "Please wait, we are redirecting you to the page where you can sign in to *NAME-OF-PROVIDER*."</span></span> <span data-ttu-id="86e9b-127">O código nessa página constrói a URL da página de entrada do provedor de identidade usando as informações que são transmitidas para a caixa de diálogo, conforme descrito em [Transmitir informações para a caixa de diálogo](dialog-api-in-office-add-ins.md#pass-information-to-the-dialog-box) ou é codificado em um arquivo de configuração do suplemento, como um arquivo web.config.</span><span class="sxs-lookup"><span data-stu-id="86e9b-127">The code in this page constructs the URL of the identity provider's sign-in page with information that is either passed to the dialog box as described in [Pass information to the dialog box](dialog-api-in-office-add-ins.md#pass-information-to-the-dialog-box) or is hardcoded into a configuration file of the add-in, such as a web.config file.</span></span>
2. <span data-ttu-id="86e9b-128">A janela de diálogo redireciona então para a página de entrada.</span><span class="sxs-lookup"><span data-stu-id="86e9b-128">The dialog window then redirects to the sign-in page.</span></span> <span data-ttu-id="86e9b-129">A URL inclui um parâmetro de consulta que informa o provedor de identidade para redirecionar a janela de diálogo a uma página específica depois que o usuário entrar.</span><span class="sxs-lookup"><span data-stu-id="86e9b-129">The URL includes a query parameter that tells the identity provider to redirect the dialog window to a specific page after the user signs in.</span></span> <span data-ttu-id="86e9b-130">Nesse artigo, chamaremos essa página de **redirectPage.html**.</span><span class="sxs-lookup"><span data-stu-id="86e9b-130">In this article, we'll call this page **redirectPage.html**.</span></span> <span data-ttu-id="86e9b-131">*Essa deve ser uma página no mesmo domínio da janela do host*, para que os resultados da tentativa de entrada possam ser passados ao painel de tarefas com uma chamada de `messageParent`.</span><span class="sxs-lookup"><span data-stu-id="86e9b-131">*This must be a page in the same domain as the host window*, so that the results of the sign-in attempt can be passed to the task pane with a call of `messageParent`.</span></span>
3. <span data-ttu-id="86e9b-132">O serviço do provedor de identidade processa a solicitação GET recebida da janela de diálogo.</span><span class="sxs-lookup"><span data-stu-id="86e9b-132">The identity provider's service processes the incoming GET request from the dialog window.</span></span> <span data-ttu-id="86e9b-133">Se o usuário já estiver conectado, ele imediatamente redirecionará a janela para **redirectPage.html** e incluirá os dados do usuário como um parâmetro de consulta.</span><span class="sxs-lookup"><span data-stu-id="86e9b-133">If the user is already signed in, it immediately redirects the window to **redirectPage.html** and includes user data as a query parameter.</span></span> <span data-ttu-id="86e9b-134">Se o usuário ainda não tiver entrado, a página de entrada do provedor aparecerá na janela para que o usuário possa entrar.</span><span class="sxs-lookup"><span data-stu-id="86e9b-134">If the user is not already signed in, the provider's sign-in page appears in the window, and the user signs in.</span></span> <span data-ttu-id="86e9b-135">Para a maioria dos provedores, se o usuário não consegue entrar com êxito, o provedor mostra uma página de erro na janela de diálogo e não redireciona para **redirectPage.html**.</span><span class="sxs-lookup"><span data-stu-id="86e9b-135">For most providers, if the user cannot sign in successfully, the provider shows an error page in the dialog window and does not redirect to **redirectPage.html**.</span></span> <span data-ttu-id="86e9b-136">O usuário precisa fechar a janela selecionando o **X** no canto.</span><span class="sxs-lookup"><span data-stu-id="86e9b-136">The user must close the window by selecting the **X** in the corner.</span></span> <span data-ttu-id="86e9b-137">Se o usuário entrar com êxito, a janela de diálogo será redirecionada para **redirectPage.html** e os dados do usuário serão incluídos como um parâmetro de consulta.</span><span class="sxs-lookup"><span data-stu-id="86e9b-137">If the user successfully signs in, the dialog window is redirected to **redirectPage.html** and user data is included as a query parameter.</span></span>
4. <span data-ttu-id="86e9b-138">Quando a página **redirectPage.html** é aberta, ela chama a `messageParent` para relatar o êxito ou a falha na página do painel de tarefas e opcionalmente também pode informar os dados do usuário ou os dados de erro.</span><span class="sxs-lookup"><span data-stu-id="86e9b-138">When the **redirectPage.html** page opens, it calls `messageParent` to report the success or failure to the task pane page and optionally also report user data or error data.</span></span> <span data-ttu-id="86e9b-139">Outras mensagens possíveis incluem passar um token de acesso ou informar ao painel de tarefas que o token está no armazenamento.</span><span class="sxs-lookup"><span data-stu-id="86e9b-139">Other possible messages include passing an access token or telling the task pane that the token is in storage.</span></span>
5. <span data-ttu-id="86e9b-140">O evento `DialogMessageReceived` é acionado na página do painel de tarefas, seu manipulador fecha a janela de diálogo e assim, a mensagem pode ser processada.</span><span class="sxs-lookup"><span data-stu-id="86e9b-140">The `DialogMessageReceived` event fires in the task pane page and its handler closes the dialog window and may further process of the message.</span></span>

#### <a name="support-multiple-identity-providers"></a><span data-ttu-id="86e9b-141">Prestar suporte a vários provedores de identidade</span><span class="sxs-lookup"><span data-stu-id="86e9b-141">Support multiple identity providers</span></span>

<span data-ttu-id="86e9b-p109">Se seu suplemento oferece ao usuário uma variedade de opções de provedores, como a Conta da Microsoft, o Google ou o Facebook, você precisa de uma primeira página local (confira a seção anterior) que forneça uma interface de usuário para a escolha de um provedor. A escolha do provedor acionará a construção da URL de entrada e seu redirecionamento.</span><span class="sxs-lookup"><span data-stu-id="86e9b-p109">If your add-in gives the user a choice of providers, such as Microsoft Account, Google, or Facebook, you need a local first page (see preceding section) that provides a UI for the user to select a provider. Selection triggers the construction of the sign-in URL and redirection to it.</span></span>

#### <a name="authorization-of-the-add-in-to-an-external-resource"></a><span data-ttu-id="86e9b-144">Autorização do suplemento para um recurso externo</span><span class="sxs-lookup"><span data-stu-id="86e9b-144">Authorization of the add-in to an external resource</span></span>

<span data-ttu-id="86e9b-145">Na Web moderna, os usuários e aplicativos da Web são entidades de segurança.</span><span class="sxs-lookup"><span data-stu-id="86e9b-145">In the modern web, users and web applications are security principals.</span></span> <span data-ttu-id="86e9b-146">O aplicativo tem sua própria identidade e permissões para recursos online, como o Office 365, Google Plus, Facebook ou LinkedIn.</span><span class="sxs-lookup"><span data-stu-id="86e9b-146">The application has its own identity and permissions to an online resource such as Office 365, Google Plus, Facebook, or LinkedIn.</span></span> <span data-ttu-id="86e9b-147">O aplicativo é registrado no provedor de recursos antes da implantação.</span><span class="sxs-lookup"><span data-stu-id="86e9b-147">The application is registered with the resource provider before it is deployed.</span></span> <span data-ttu-id="86e9b-148">O registro inclui:</span><span class="sxs-lookup"><span data-stu-id="86e9b-148">The registration includes:</span></span>

- <span data-ttu-id="86e9b-149">Uma lista das permissões que o aplicativo precisa.</span><span class="sxs-lookup"><span data-stu-id="86e9b-149">A list of the permissions that the application needs.</span></span>
- <span data-ttu-id="86e9b-150">Uma URL para a qual o serviço do recurso deve retornar um token de acesso quando o aplicativo acessa o serviço.</span><span class="sxs-lookup"><span data-stu-id="86e9b-150">A URL to which the resource service should return an access token when the application accesses the service.</span></span>  

<span data-ttu-id="86e9b-p111">Quando um usuário invoca uma função no aplicativo que acessa os dados do usuário no serviço do recurso, ele é solicitado a entrar no serviço e a conceder ao aplicativo as permissões necessárias para os recursos do usuário. Em seguida, o serviço redireciona a janela de entrada para a URL previamente registrada e transmite o token de acesso. O aplicativo usa o token de acesso para acessar os recursos do usuário.</span><span class="sxs-lookup"><span data-stu-id="86e9b-p111">When a user invokes a function in the application that accesses the user's data in the resource service, they are prompted to sign in to the service and then prompted to grant the application the permissions it needs to the user's resources. The service then redirects the sign-in window to the previously registered URL and passes the access token. The application uses the access token to access the user's resources.</span></span>

<span data-ttu-id="86e9b-154">Você pode usar a API da Caixa de Diálogo para gerenciar esse processo usando um fluxo semelhante àquele descrito para os usuários entrarem.</span><span class="sxs-lookup"><span data-stu-id="86e9b-154">You can use the Dialog API to manage this process by using a flow that is similar to the one described for users to sign in.</span></span> <span data-ttu-id="86e9b-155">As únicas diferenças são:</span><span class="sxs-lookup"><span data-stu-id="86e9b-155">The only differences are:</span></span>

- <span data-ttu-id="86e9b-156">Se o usuário ainda não tiver concedido ao aplicativo as permissões necessárias, será solicitado a fazê-lo na caixa de diálogo após entrar.</span><span class="sxs-lookup"><span data-stu-id="86e9b-156">If the user hasn't previously granted the application the permissions it needs, the user is prompted to do so in the dialog box after signing in.</span></span>
- <span data-ttu-id="86e9b-157">A janela de diálogo envia o token de acesso à janela do host usando `messageParent` para enviar o token de acesso em formato de cadeia de caracteres ou armazenando o token de acesso em um local onde a janela do host poderá recuperá-lo (e usando `messageParent` para informar à janela do host que o token está disponível).</span><span class="sxs-lookup"><span data-stu-id="86e9b-157">The dialog window sends the access token to the host window either by using `messageParent` to send the stringified access token or by storing the access token where the host window can retrieve it (and using `messageParent` to tell the host window that the token is available).</span></span> <span data-ttu-id="86e9b-158">O token tem um limite de tempo, mas enquanto durar, a janela do host poder usá-lo para acessar recursos do usuário de forma direta, sem outras solicitações.</span><span class="sxs-lookup"><span data-stu-id="86e9b-158">The token has a time limit, but while it lasts, the host window can use it to directly access the user's resources without any further prompting.</span></span>

<span data-ttu-id="86e9b-159">Alguns suplementos de exemplo de autenticação que usam a API da Caixa de Diálogo para essa finalidade estão listados em [Amostras](#samples).</span><span class="sxs-lookup"><span data-stu-id="86e9b-159">Some authentication sample add-ins that use the Dialog API for this purpose are listed in [Samples](#samples).</span></span>

## <a name="using-authentication-libraries-with-the-dialog"></a><span data-ttu-id="86e9b-160">Usar bibliotecas de autenticação pela caixa de diálogo</span><span class="sxs-lookup"><span data-stu-id="86e9b-160">Using authentication libraries with the dialog</span></span>

<span data-ttu-id="86e9b-161">O fato da Caixa de Diálogo do Office e o painel de tarefas serem executados em navegadores diferentes e no tempo de execução do JavaScript, as instâncias significam que você deve usar muitas bibliotecas de autenticação/autorização de maneira diferente de como elas são usadas quando a autenticação e a autorização ocorrem na mesma janela.</span><span class="sxs-lookup"><span data-stu-id="86e9b-161">The fact that the Office Dialog and the task pane run in different browser, and JavaScript runtime, instances means that you must use many authentication/authorization libraries in the way that is different from how they are used when authentication and authorization can take place in the same window.</span></span> <span data-ttu-id="86e9b-162">As seções a seguir descrevem as principais maneiras pelas quais, geralmente, você não pode usar essas bibliotecas e a maneira que você *pode* usá-las.</span><span class="sxs-lookup"><span data-stu-id="86e9b-162">The following sections describe the main ways that you usually cannot use these libraries and the way that you *can* use them.</span></span>

### <a name="you-usually-cannot-use-the-librarys-internal-cache-to-store-tokens"></a><span data-ttu-id="86e9b-163">Geralmente, você não pode usar o cache interno da biblioteca para armazenar tokens</span><span class="sxs-lookup"><span data-stu-id="86e9b-163">You usually cannot use the library's internal cache to store tokens</span></span>

<span data-ttu-id="86e9b-164">Normalmente, as bibliotecas relacionadas à autenticação fornecem um cache na memória para armazenar o token de acesso.</span><span class="sxs-lookup"><span data-stu-id="86e9b-164">Typically, auth-related libraries provide an in-memory cache to store the access token.</span></span> <span data-ttu-id="86e9b-165">Se chamadas subsequentes para o provedor de recursos (por exemplo, Google, Microsoft Graph, Facebook, etc.) forem feitas, a biblioteca primeiro verificará se o token no cache está expirado.</span><span class="sxs-lookup"><span data-stu-id="86e9b-165">If subsequent calls to the resource provider (such as Google, Microsoft Graph, Facebook, etc.) are made, the library will first check to see if the token in its cache is expired.</span></span> <span data-ttu-id="86e9b-166">Caso não tenha expirado, a biblioteca retornará o token em cache, em vez de retornar ao STS para obter um novo token.</span><span class="sxs-lookup"><span data-stu-id="86e9b-166">If it is unexpired, the library returns the cached token rather than making another round-trip to the STS for a new token.</span></span> <span data-ttu-id="86e9b-167">No entanto, esse padrão não pode ser usado em suplementos do Office. Uma vez que o logon ocorre na instância do navegador da Caixa de Diálogo do Office, o cache do token estará nessa instância.</span><span class="sxs-lookup"><span data-stu-id="86e9b-167">But this pattern is not usable in Office add-ins. Since the login occurs in the Office Dialog's browser instance, the token cache is in that instance.</span></span>

<span data-ttu-id="86e9b-168">Estritamente relacionado a isso está o fato de que uma biblioteca normalmente fornece métodos interativos e "silenciosos" para obter um token.</span><span class="sxs-lookup"><span data-stu-id="86e9b-168">Closely related to this is the fact that a library will typically provide both interactive and "silent" methods for getting a token.</span></span> <span data-ttu-id="86e9b-169">Quando for possível fazer tanto a autenticação quanto as chamadas de dados ao recurso na mesma instância do navegador, o código chamará o método silencioso para obter um token imediatamente antes do código adicionar o token à chamada de dados.</span><span class="sxs-lookup"><span data-stu-id="86e9b-169">When you can do both the authentication and the data calls to the resource in the same browser instance, your code calls the silent method to obtain a token just before your code adds the token to the data call.</span></span> <span data-ttu-id="86e9b-170">O método silencioso procurará por um token não expirado no cache e o retornará, caso haja um.</span><span class="sxs-lookup"><span data-stu-id="86e9b-170">The silent method checks for an unexpired token in the cache and returns it, if there is one.</span></span> <span data-ttu-id="86e9b-171">Caso contrário, o método silencioso chamará o método interativo que será redirecionado para o logon do STS.</span><span class="sxs-lookup"><span data-stu-id="86e9b-171">Otherwise, the silent method calls the interactive method which redirects to the STS's login.</span></span> <span data-ttu-id="86e9b-172">Após a conclusão do logon, o método interativo retorna o token e o armazena na memória.</span><span class="sxs-lookup"><span data-stu-id="86e9b-172">After login completes, the interactive method returns the token, but also caches it in memory.</span></span> <span data-ttu-id="86e9b-173">No entanto, quando a API da Caixa de Diálogo do Office está sendo usada, as chamadas de dados do recurso, que chamam o método silencioso, estão na instância do navegador do painel de tarefas.</span><span class="sxs-lookup"><span data-stu-id="86e9b-173">But when the Office Dialog API is being used, the data calls to the resource, which would call the silent method, are in the task pane's browser instance.</span></span> <span data-ttu-id="86e9b-174">O cache de token da biblioteca não existe nessa instância.</span><span class="sxs-lookup"><span data-stu-id="86e9b-174">The library's token cache does not exist in that instance.</span></span>

<span data-ttu-id="86e9b-175">Como alternativa, a instância do navegador da Caixa de Diálogo do suplemento pode chamar diretamente o método interativo da biblioteca.</span><span class="sxs-lookup"><span data-stu-id="86e9b-175">As an alternative, your add-in's Dialog browser instance can directly call the library's interactive method.</span></span> <span data-ttu-id="86e9b-176">Quando esse método retorna um token, o código deve armazenar explicitamente o token em algum lugar onde a instância do navegador do painel de tarefas pode recuperá-lo, como o Armazenamento Local\* ou um banco de dados do lado do servidor.</span><span class="sxs-lookup"><span data-stu-id="86e9b-176">When that method returns a token, your code must explicitly store the token someplace where the task pane's browser instance can retrieve it, such as Local Storage or a server-side database.</span></span> <span data-ttu-id="86e9b-177">Outra opção é passar o token para o painel de tarefas com o método `messageParent`.</span><span class="sxs-lookup"><span data-stu-id="86e9b-177">Another option is to pass the token to the task pane with the `messageParent` method.</span></span> <span data-ttu-id="86e9b-178">Essa alternativa só é possível se o método interativo armazenar o token de acesso em um local onde o código possa lê-lo.</span><span class="sxs-lookup"><span data-stu-id="86e9b-178">This alternative is only possible if the interactive method stores the access token in a place where your code can read it.</span></span> <span data-ttu-id="86e9b-179">Às vezes, o método interativo de uma biblioteca é projetado para armazenar o token em uma propriedade particular de um objeto que está inacessível ao código.</span><span class="sxs-lookup"><span data-stu-id="86e9b-179">Sometimes a library's interactive method is designed to store the token in a private property of an object that is inaccessible to your code.</span></span>

> [!NOTE]
> <span data-ttu-id="86e9b-180">\* Há um bug que afetará sua estratégia de tratamento de tokens.</span><span class="sxs-lookup"><span data-stu-id="86e9b-180">\* There is a bug that will effect your strategy for token handling.</span></span> <span data-ttu-id="86e9b-181">Se o suplemento estiver sendo executado no **Office na Web** nos navegadores Safari ou Edge, o painel de tarefas e a caixa de diálogo não compartilharão o mesmo Armazenamento Local, portanto, ele não poderá ser usado para a comunicação entre eles.</span><span class="sxs-lookup"><span data-stu-id="86e9b-181">If the add-in is running in **Office on the web** in either the Safari or Edge browser, the dialog and task pane do not share the same Local Storage, so it cannot be used to communicate between them.</span></span>

### <a name="you-usually-cannot-use-the-librarys-auth-context-object"></a><span data-ttu-id="86e9b-182">Geralmente, você não pode usar o objeto "contexto de autenticação" da biblioteca</span><span class="sxs-lookup"><span data-stu-id="86e9b-182">You usually cannot use the library's "auth context" object</span></span>

<span data-ttu-id="86e9b-183">Frequentemente, uma biblioteca relacionada à autenticação possui um método que obtém tanto um token de forma interativa, como também cria um objeto de "contexto de autenticação" retornado pelo método.</span><span class="sxs-lookup"><span data-stu-id="86e9b-183">Often, an auth-related library has a method that both obtains a token interactively and also creates an "auth-context" object which the method returns.</span></span> <span data-ttu-id="86e9b-184">O token é uma propriedade do objeto (possivelmente particular e inacessível diretamente do código).</span><span class="sxs-lookup"><span data-stu-id="86e9b-184">The token is a property of the object (possibly private and inaccessible directly from your code).</span></span> <span data-ttu-id="86e9b-185">Esse objeto tem os métodos que recebem os dados do recurso.</span><span class="sxs-lookup"><span data-stu-id="86e9b-185">That object has the methods that get data from the resource.</span></span> <span data-ttu-id="86e9b-186">Esses métodos incluem o token nas Solicitações HTTP feitas ao provedor de recursos (por exemplo, Google, Microsoft Graph, Facebook, etc.).</span><span class="sxs-lookup"><span data-stu-id="86e9b-186">These methods include the token in the HTTP Requests that they make to the resource provider (such as Google, Microsoft Graph, Facebook, etc.).</span></span>

<span data-ttu-id="86e9b-187">Esses objetos de contexto de autenticação e os métodos que os criam não podem ser usados nos suplementos do Office. Como o logon ocorre na instância do navegador da Caixa de Diálogo do Office, o objeto teria que ser criado lá.</span><span class="sxs-lookup"><span data-stu-id="86e9b-187">These auth-context objects, and the methods that create them, are not usable in Office add-ins. Since the login occurs in the Office Dialog's browser instance, the object would have to be created there.</span></span> <span data-ttu-id="86e9b-188">Mas as chamadas de dados do recurso estão na instância do navegador do painel de tarefas e não há como enviar o objeto de uma instância para outra.</span><span class="sxs-lookup"><span data-stu-id="86e9b-188">But the data calls to the resource are in the task pane browser instance and there is no way to get the object from one instance to another.</span></span> <span data-ttu-id="86e9b-189">Por exemplo, não é possível passar o objeto pela `messageParent`, porque a `messageParent` só pode passar valores booleanos ou cadeias de caracteres.</span><span class="sxs-lookup"><span data-stu-id="86e9b-189">For example, you cannot pass the object with `messageParent` because `messageParent` can only pass strings or boolean values.</span></span> <span data-ttu-id="86e9b-190">Um objeto do JavaScript com métodos não pode ser transformado em cadeia de caracteres de maneira confiável.</span><span class="sxs-lookup"><span data-stu-id="86e9b-190">A JavaScript object with methods cannot be reliably stringified.</span></span>

### <a name="how-you-can-use-libraries-with-the-office-dialog-api"></a><span data-ttu-id="86e9b-191">Como você pode usar as bibliotecas através da API da Caixa de Diálogo do Office</span><span class="sxs-lookup"><span data-stu-id="86e9b-191">How you can use libraries with the Office Dialog API</span></span>

<span data-ttu-id="86e9b-192">Além dos objetos monolíticos de "contexto de autenticação", a maioria das bibliotecas fornecem APIs em um nível inferior de abstração que permite que o código crie objetos auxiliares menos monolíticos.</span><span class="sxs-lookup"><span data-stu-id="86e9b-192">In addition to, or instead of, monolithic "auth context" objects, most libraries provide APIs at a lower level of abstraction that enable your code to create less monolithic helper objects.</span></span> <span data-ttu-id="86e9b-193">Por exemplo, [MSAL.NET](https://github.com/AzureAD/microsoft-authentication-library-for-dotnet/wiki#conceptual-documentation) v.</span><span class="sxs-lookup"><span data-stu-id="86e9b-193">For example, [MSAL.NET](https://github.com/AzureAD/microsoft-authentication-library-for-dotnet/wiki#conceptual-documentation) v.</span></span> <span data-ttu-id="86e9b-194">3.x.x tem uma API para construir uma URL de logon e outra API que constrói um objeto AuthResult que contém um token de acesso em uma propriedade que pode ser acessada pelo código.</span><span class="sxs-lookup"><span data-stu-id="86e9b-194">3.x.x has an API to construct a login URL, and another API that constructs an AuthResult object that contains an access token in a property that is accessible to your code.</span></span> <span data-ttu-id="86e9b-195">Para obter exemplos de MSAL.NET em um suplemento do Office, confira: [ASP.NET Microsoft Graph no Suplemento do Office](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Office-Add-in-Microsoft-Graph-ASPNET) e [ASP.NET Microsoft Graph no Suplemento do Outlook](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Outlook-Add-in-Microsoft-Graph-ASPNET).</span><span class="sxs-lookup"><span data-stu-id="86e9b-195">For examples of MSAL.NET in an Office add-in see: [Office Add-in Microsoft Graph ASP.NET](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Office-Add-in-Microsoft-Graph-ASPNET) and [Outlook Add-in Microsoft Graph ASP.NET](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Outlook-Add-in-Microsoft-Graph-ASPNET).</span></span> <span data-ttu-id="86e9b-196">Para ver um exemplo de como usar o [msal.js](https://github.com/AzureAD/microsoft-authentication-library-for-js) em um suplemento, confira [Microsoft Graph React no Suplemento do Office](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Office-Add-in-Microsoft-Graph-React).</span><span class="sxs-lookup"><span data-stu-id="86e9b-196">For an example of using [msal.js](https://github.com/AzureAD/microsoft-authentication-library-for-js) in an add-in, see [Office Add-in Microsoft Graph React](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Office-Add-in-Microsoft-Graph-React).</span></span>

<span data-ttu-id="86e9b-197">Para saber mais sobre as bibliotecas de autenticação e autorização, confira [Microsoft Graph: bibliotecas recomendadas](authorize-to-microsoft-graph-without-sso.md#recommended-libraries-and-samples) e [Outros serviços externos: bibliotecas](auth-external-add-ins.md#libraries).</span><span class="sxs-lookup"><span data-stu-id="86e9b-197">For more information about authentication and authorization libraries, see [Microsoft Graph: Recommended libraries](authorize-to-microsoft-graph-without-sso.md#recommended-libraries-and-samples) and [Other external services: Libraries](auth-external-add-ins.md#libraries).</span></span>

## <a name="samples"></a><span data-ttu-id="86e9b-198">Exemplos</span><span class="sxs-lookup"><span data-stu-id="86e9b-198">Samples</span></span>

- <span data-ttu-id="86e9b-199">[ASP.NET Microsoft Graph no Suplemento do Office](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Office-Add-in-Microsoft-Graph-ASPNET): um suplemento com base em ASP.NET (Excel, Word ou PowerPoint) que usa a biblioteca MSAL.NET e o Fluxo de Código de Autorização para efetuar logon e obter um token de acesso para dados do Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="86e9b-199">[Office Add-in Microsoft Graph ASP.NET](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Office-Add-in-Microsoft-Graph-ASPNET): An ASP.NET based add-in (Excel, Word, or PowerPoint) that uses the MSAL.NET library to login and get an access token for Microsoft Graph data.</span></span>
- <span data-ttu-id="86e9b-200">[ASP.NET Microsoft Graph no Suplemento do Outlook](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Outlook-Add-in-Microsoft-Graph-ASPNET): semelhante a exibida acima, mas o aplicativo do Office sendo o Outlook.</span><span class="sxs-lookup"><span data-stu-id="86e9b-200">[Outlook Add-in Microsoft Graph ASP.NET](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Outlook-Add-in-Microsoft-Graph-ASPNET): Just like the one above, but the Office application is Outlook.</span></span>
- <span data-ttu-id="86e9b-201">[Microsoft Graph React no Suplemento do Office](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Office-Add-in-Microsoft-Graph-React): um suplemento com base em NodeJS (Excel, Word ou PowerPoint) que usa a biblioteca msal.js e o Fluxo Implícito para efetuar logon e obter um token de acesso para dados do Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="86e9b-201">[Office Add-in Microsoft Graph React](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Office-Add-in-Microsoft-Graph-React): A NodeJS based add-in (Excel, Word, or PowerPoint) that uses the msal.js library and the Implicit Flow to log in and get an access token for Microsoft Graph data.</span></span>


<span data-ttu-id="86e9b-202">Para saber mais, confira:</span><span class="sxs-lookup"><span data-stu-id="86e9b-202">For more information, see:</span></span>
- [<span data-ttu-id="86e9b-203">Autorizar serviços externos no Suplemento do Office</span><span class="sxs-lookup"><span data-stu-id="86e9b-203">Authorize external services in your Office Add-in</span></span>](auth-external-add-ins.md)
- [<span data-ttu-id="86e9b-204">Usar a API da Caixa de Diálogo nos suplementos do Office</span><span class="sxs-lookup"><span data-stu-id="86e9b-204">Use the Dialog API in your Office Add-ins</span></span>](dialog-api-in-office-add-ins.md)
