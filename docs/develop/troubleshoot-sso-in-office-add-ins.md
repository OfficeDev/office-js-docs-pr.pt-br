---
title: Solucionar problemas de mensagens de erro no logon único (SSO)
description: Orientações sobre como solucionar problemas com logon único (SSO) em suplementos do Office e lidar com condições ou erros especiais.
ms.date: 07/07/2020
localization_priority: Normal
ms.openlocfilehash: 49e967aa0d500df64828c66d9dee8574eb948cec
ms.sourcegitcommit: 7ef14753dce598a5804dad8802df7aaafe046da7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/10/2020
ms.locfileid: "45093557"
---
# <a name="troubleshoot-error-messages-for-single-sign-on-sso-preview"></a><span data-ttu-id="d78ef-103">Solucionar problemas de mensagens de erro no logon único (SSO) (visualização)</span><span class="sxs-lookup"><span data-stu-id="d78ef-103">Troubleshoot error messages for single sign-on (SSO) (preview)</span></span>

<span data-ttu-id="d78ef-104">Este artigo fornece algumas orientações sobre como solucionar problemas com o logon único (SSO) nos suplementos do Office e como fazer com que seu suplemento habilitado para SSO lide de forma robusta com os erros ou condições especiais.</span><span class="sxs-lookup"><span data-stu-id="d78ef-104">This article provides some guidance about how to troubleshoot problems with single sign-on (SSO) in Office Add-ins, and how to make your SSO-enabled add-in robustly handle special conditions or errors.</span></span>

> [!NOTE]
> <span data-ttu-id="d78ef-105">Atualmente, a API de logon único tem suporte para Word, Excel, Outlook e PowerPoint.</span><span class="sxs-lookup"><span data-stu-id="d78ef-105">The Single Sign-on API is currently supported in preview for Word, Excel, Outlook, and PowerPoint.</span></span> <span data-ttu-id="d78ef-106">Confira mais informações sobre os programas para os quais a API de logon único tem suporte no momento em [Conjuntos de requisitos da IdentityAPI](../reference/requirement-sets/identity-api-requirement-sets.md).</span><span class="sxs-lookup"><span data-stu-id="d78ef-106">For more information about where the Single Sign-on API is currently supported, see [IdentityAPI requirement sets](../reference/requirement-sets/identity-api-requirement-sets.md).</span></span>
> [!INCLUDE [Information about using preview APIs](../includes/using-excel-preview-apis.md)]
> <span data-ttu-id="d78ef-107">Se você estiver trabalhando com um suplemento do Outlook, certifique-se de habilitar a autenticação moderna para o Microsoft 365 locação.</span><span class="sxs-lookup"><span data-stu-id="d78ef-107">If you are working with an Outlook add-in, be sure to enable Modern Authentication for the Microsoft 365 tenancy.</span></span> <span data-ttu-id="d78ef-108">Confira mais informações sobre como fazer isso em [Exchange Online: como habilitar seu locatário para autenticação moderna](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span><span class="sxs-lookup"><span data-stu-id="d78ef-108">For information about how to do this, see [Exchange Online: How to enable your tenant for modern authentication](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span></span>

## <a name="debugging-tools"></a><span data-ttu-id="d78ef-109">Ferramentas de depuração</span><span class="sxs-lookup"><span data-stu-id="d78ef-109">Debugging tools</span></span>

<span data-ttu-id="d78ef-p103">Recomendamos fortemente que você use uma ferramenta que possa interceptar e exibir as solicitações HTTP a partir de seu serviço Web do suplemento, além de respostas para ele, quando você estiver desenvolvendo. Duas das ferramentas mais populares são:</span><span class="sxs-lookup"><span data-stu-id="d78ef-p103">We strongly recommend that you use a tool that can intercept and display the HTTP Requests from, and Responses to, your add-in's web service when you are developing. Two of the most popular are:</span></span>

- <span data-ttu-id="d78ef-112">[Fiddler](https://www.telerik.com/fiddler): gratuita ([Documentação](https://docs.telerik.com/fiddler/configure-fiddler/tasks/configurefiddler))</span><span class="sxs-lookup"><span data-stu-id="d78ef-112">[Fiddler](https://www.telerik.com/fiddler): Free ([Documentation](https://docs.telerik.com/fiddler/configure-fiddler/tasks/configurefiddler))</span></span>
- <span data-ttu-id="d78ef-113">[Charles](https://www.charlesproxy.com): Gratuita por 30 dias.</span><span class="sxs-lookup"><span data-stu-id="d78ef-113">[Charles](https://www.charlesproxy.com): Free for 30 days.</span></span> <span data-ttu-id="d78ef-114">([Documentação](https://www.charlesproxy.com/documentation/))</span><span class="sxs-lookup"><span data-stu-id="d78ef-114">([Documentation](https://www.charlesproxy.com/documentation/))</span></span>

## <a name="causes-and-handling-of-errors-from-getaccesstoken"></a><span data-ttu-id="d78ef-115">Causas e tratamento dos erros do getAccessToken</span><span class="sxs-lookup"><span data-stu-id="d78ef-115">Causes and handling of errors from getAccessToken</span></span>

<span data-ttu-id="d78ef-116">Para acessar exemplos de tratamento de erro descritos nesta seção, confira:</span><span class="sxs-lookup"><span data-stu-id="d78ef-116">For examples of the error handling described in this section, see:</span></span>
- [<span data-ttu-id="d78ef-117">HomeES6.js em Office-Add-in-ASPNET-SSO</span><span class="sxs-lookup"><span data-stu-id="d78ef-117">HomeES6.js in Office-Add-in-ASPNET-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-ASPNET-SSO/blob/master/Complete/Office-Add-in-ASPNET-SSO-WebAPI/Scripts/HomeES6.js)
- [<span data-ttu-id="d78ef-118">ssoAuthES6.js em Office-Add-in-NodeJS-SSO</span><span class="sxs-lookup"><span data-stu-id="d78ef-118">ssoAuthES6.js in Office-Add-in-NodeJS-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO/blob/master/Complete/public/javascripts/ssoAuthES6.js)

### <a name="13000"></a><span data-ttu-id="d78ef-119">13000</span><span class="sxs-lookup"><span data-stu-id="d78ef-119">13000</span></span>

<span data-ttu-id="d78ef-120">A API [getAccessToken](../develop/sso-in-office-add-ins.md#sso-api-reference) não é compatível pelo suplemento ou pela versão do Office.</span><span class="sxs-lookup"><span data-stu-id="d78ef-120">The [getAccessToken](../develop/sso-in-office-add-ins.md#sso-api-reference) API is not supported by the add-in or the Office version.</span></span>

- <span data-ttu-id="d78ef-121">A versão do Office não é compatível com o SSO.</span><span class="sxs-lookup"><span data-stu-id="d78ef-121">The version of Office does not support SSO.</span></span> <span data-ttu-id="d78ef-122">A versão necessária é assinatura da Microsoft 365, em qualquer canal mensal.</span><span class="sxs-lookup"><span data-stu-id="d78ef-122">The required version is Microsoft 365 subscription, in any monthly channel.</span></span>
- <span data-ttu-id="d78ef-123">O manifesto do suplemento está sem a seção [WebApplicationInfo](../reference/manifest/webapplicationinfo.md) adequada.</span><span class="sxs-lookup"><span data-stu-id="d78ef-123">The add-in manifest is missing the proper [WebApplicationInfo](../reference/manifest/webapplicationinfo.md) section.</span></span>

<span data-ttu-id="d78ef-124">O suplemento deverá responder a esse erro recorrendo a um sistema de autenticação de usuário alternativo.</span><span class="sxs-lookup"><span data-stu-id="d78ef-124">Your add-in should respond to this error by falling back to an alternate system of user authentication.</span></span> <span data-ttu-id="d78ef-125">Para obter mais informações, confira [Requisitos e Melhores Práticas](../develop/sso-in-office-add-ins.md#requirements-and-best-practices).</span><span class="sxs-lookup"><span data-stu-id="d78ef-125">For more information, see [Requirements and Best Practices](../develop/sso-in-office-add-ins.md#requirements-and-best-practices).</span></span>

### <a name="13001"></a><span data-ttu-id="d78ef-126">13001</span><span class="sxs-lookup"><span data-stu-id="d78ef-126">13001</span></span>

<span data-ttu-id="d78ef-127">O usuário não iniciou sessão no Office.</span><span class="sxs-lookup"><span data-stu-id="d78ef-127">The user is not signed into Office.</span></span> <span data-ttu-id="d78ef-128">Na maioria dos cenários, você deve evitar que esse erro apareça passando a opção `allowSignInPrompt: true` no parâmetro `AuthOptions`.</span><span class="sxs-lookup"><span data-stu-id="d78ef-128">In most scenarios, you should prevent this error from ever being seen by passing the option `allowSignInPrompt: true` in the `AuthOptions` parameter.</span></span>

<span data-ttu-id="d78ef-129">Mas pode haver exceções.</span><span class="sxs-lookup"><span data-stu-id="d78ef-129">But there may be exceptions.</span></span> <span data-ttu-id="d78ef-130">Por exemplo, no caso de você desejar que o suplemento seja aberto com recursos que exijam um usuário conectado; mas *somente se* o usuário *já* estiver conectado ao Office.</span><span class="sxs-lookup"><span data-stu-id="d78ef-130">For example, you want the add-in to open with features that require a logged in user; but *only if* the user is *already* logged into Office.</span></span> <span data-ttu-id="d78ef-131">Se o usuário não estiver conectado, e você deseja que o suplemento seja aberto com um conjunto alternativo de recursos que não exijam que o usuário esteja.</span><span class="sxs-lookup"><span data-stu-id="d78ef-131">If the user is not, you want the add-in to open with an alternate set of features that do not require that the user is signed in.</span></span> <span data-ttu-id="d78ef-132">Nesse caso, essa é a lógica executada quando o suplemento inicia chamadas `getAccessToken` sem `allowSignInPrompt: true`.</span><span class="sxs-lookup"><span data-stu-id="d78ef-132">In this case, logic which runs when the add-in launches calls `getAccessToken` without `allowSignInPrompt: true`.</span></span> <span data-ttu-id="d78ef-133">Use o erro 13001 como sinalizador para informar ao suplemento para apresentar o conjunto alternativo de recursos.</span><span class="sxs-lookup"><span data-stu-id="d78ef-133">Use the 13001 error as the flag to tell the add-in to present the alternate set of features.</span></span>

<span data-ttu-id="d78ef-134">Outra opção é responder ao 13001 recorrendo a um sistema alternativo de autenticação de usuário.</span><span class="sxs-lookup"><span data-stu-id="d78ef-134">Another option is to respond to 13001 by falling back to an alternate system of user authentication.</span></span> <span data-ttu-id="d78ef-135">Isso conectará o usuário ao AAD, mas não o conectará ao Office.</span><span class="sxs-lookup"><span data-stu-id="d78ef-135">This will sign the user into AAD, but not sign the user into Office.</span></span>

<span data-ttu-id="d78ef-136">Este erro nunca aparece no **Office na Web**.</span><span class="sxs-lookup"><span data-stu-id="d78ef-136">This error is never seen in **Office on the web**.</span></span> <span data-ttu-id="d78ef-137">Se os cookies do usuário expirarem, o **Office na Web** retornará o erro 13006.</span><span class="sxs-lookup"><span data-stu-id="d78ef-137">If the user's cookie expires, **Office on the web** returns error 13006.</span></span>

### <a name="13002"></a><span data-ttu-id="d78ef-138">13002</span><span class="sxs-lookup"><span data-stu-id="d78ef-138">13002</span></span>

<span data-ttu-id="d78ef-139">O usuário abortou a entrada ou o consentimento; por exemplo, escolhendo **Cancelar** no diálogo de consentimento.</span><span class="sxs-lookup"><span data-stu-id="d78ef-139">The user aborted sign in or consent; for example, by choosing **Cancel** on the consent dialog.</span></span>

- <span data-ttu-id="d78ef-140">Se o seu suplemento fornece funções que não exigem que o usuário esteja conectado (ou que tenha concedido o consentimento), seu código deve capturar esse erro e permitir que o suplemento permaneça em execução.</span><span class="sxs-lookup"><span data-stu-id="d78ef-140">If your add-in provides functions that don't require the user to be signed in (or to have granted consent), then your code should catch this error and allow the add-in to stay running.</span></span>
- <span data-ttu-id="d78ef-141">Se o suplemento exigir um usuário conectado que tenha dado consentimento, o código deverá exibir um botão de logon.</span><span class="sxs-lookup"><span data-stu-id="d78ef-141">If the add-in requires a signed-in user who has granted consent, your code should have a sign-in button appear.</span></span>

### <a name="13003"></a><span data-ttu-id="d78ef-142">13003</span><span class="sxs-lookup"><span data-stu-id="d78ef-142">13003</span></span>

<span data-ttu-id="d78ef-143">Tipo de Usuário não suportado.</span><span class="sxs-lookup"><span data-stu-id="d78ef-143">User Type not supported.</span></span> <span data-ttu-id="d78ef-144">O usuário não está conectado ao Office com uma conta Microsoft válida ou uma conta de treinamento ou de trabalho do Microsoft 365.</span><span class="sxs-lookup"><span data-stu-id="d78ef-144">The user isn't signed into Office with a valid Microsoft Account or Microsoft 365 Education or work account.</span></span> <span data-ttu-id="d78ef-145">Isso pode acontecer se o Office funcionar com uma conta de domínio no local, por exemplo.</span><span class="sxs-lookup"><span data-stu-id="d78ef-145">This may happen if Office runs with an on-premises domain account, for example.</span></span> <span data-ttu-id="d78ef-146">O código deve retornar a um sistema alternativo de autenticação de usuário.</span><span class="sxs-lookup"><span data-stu-id="d78ef-146">Your code should fall back to an alternate system of user authentication.</span></span> <span data-ttu-id="d78ef-147">Para obter mais informações, confira [Requisitos e Melhores Práticas](../develop/sso-in-office-add-ins.md#requirements-and-best-practices).</span><span class="sxs-lookup"><span data-stu-id="d78ef-147">For more information, see [Requirements and Best Practices](../develop/sso-in-office-add-ins.md#requirements-and-best-practices).</span></span>

### <a name="13004"></a><span data-ttu-id="d78ef-148">13004</span><span class="sxs-lookup"><span data-stu-id="d78ef-148">13004</span></span>

<span data-ttu-id="d78ef-149">Recurso inválido.</span><span class="sxs-lookup"><span data-stu-id="d78ef-149">Invalid Resource.</span></span> <span data-ttu-id="d78ef-150">(Esse erro só deve ser visto no desenvolvimento.) O manifesto do suplemento não foi configurado corretamente.</span><span class="sxs-lookup"><span data-stu-id="d78ef-150">(This error should only be seen in development.) The add-in manifest hasn't been configured correctly.</span></span> <span data-ttu-id="d78ef-151">Atualize o manifesto.</span><span class="sxs-lookup"><span data-stu-id="d78ef-151">Update the manifest.</span></span> <span data-ttu-id="d78ef-152">Para saber mais, confira [Validar o manifesto de suplemento do Office](../testing/troubleshoot-manifest.md).</span><span class="sxs-lookup"><span data-stu-id="d78ef-152">For more information, see [Validate an Office Add-in's manifest](../testing/troubleshoot-manifest.md).</span></span> <span data-ttu-id="d78ef-153">O problema mais comum é que o elemento **Resource** (no elemento **WebApplicationInfo**) tem um domínio que não corresponde ao domínio do suplemento.</span><span class="sxs-lookup"><span data-stu-id="d78ef-153">The most common problem is that the **Resource** element (in the **WebApplicationInfo** element) has a domain that does not match the domain of the add-in.</span></span> <span data-ttu-id="d78ef-154">Embora a parte do protocolo do valor Resource deva ser “api” e não “https”, todas as outras partes do nome de domínio (incluindo a porta, se houver) devem ser as mesmas para o suplemento.</span><span class="sxs-lookup"><span data-stu-id="d78ef-154">Although the protocol part of the Resource value should be "api" not "https"; all other parts of the domain name (including port, if any) should be the same as for the add-in.</span></span>

### <a name="13005"></a><span data-ttu-id="d78ef-155">13005</span><span class="sxs-lookup"><span data-stu-id="d78ef-155">13005</span></span>

<span data-ttu-id="d78ef-156">Concessão inválida.</span><span class="sxs-lookup"><span data-stu-id="d78ef-156">Invalid Grant.</span></span> <span data-ttu-id="d78ef-157">Isso geralmente significa que o Office não foi pré-autorizado para o serviço Web do suplemento.</span><span class="sxs-lookup"><span data-stu-id="d78ef-157">This usually means that Office has not been pre-authorized to the add-in's web service.</span></span> <span data-ttu-id="d78ef-158">Para obter mais informações, confira [Criar o aplicativo de serviço](sso-in-office-add-ins.md#create-the-service-application) e [Registrar o suplemento com o ponto de extremidade v2.0 do Azure AD](register-sso-add-in-aad-v2.md).</span><span class="sxs-lookup"><span data-stu-id="d78ef-158">For more information, see [Create the service application](sso-in-office-add-ins.md#create-the-service-application) and [Register the add-in with Azure AD v2.0 endpoint](register-sso-add-in-aad-v2.md).</span></span> <span data-ttu-id="d78ef-159">Isso também pode acontecer se o usuário não concedeu as permissões de aplicativo de serviço para o seu `profile`, ou se tiver revogado um consentimento.</span><span class="sxs-lookup"><span data-stu-id="d78ef-159">This also may happen if the user has not granted your service application permissions to their `profile`, or has revoked consent.</span></span> <span data-ttu-id="d78ef-160">O código deve retornar a um sistema alternativo de autenticação de usuário.</span><span class="sxs-lookup"><span data-stu-id="d78ef-160">Your code should fall back to an alternate system of user authentication.</span></span>

<span data-ttu-id="d78ef-161">Outra causa possível durante o desenvolvimento, é que o suplemento esteja usando o Internet Explorer e você um certificado autoassinado.</span><span class="sxs-lookup"><span data-stu-id="d78ef-161">Another possible cause, during development, is that your add-in using Internet Explorer, and you are using a self-signed certificate.</span></span> <span data-ttu-id="d78ef-162">(Para determinar qual navegador está sendo usado em seu computador de desenvolvimento, confira [Navegadores usados pelos Suplementos do Offices](../concepts/browsers-used-by-office-web-add-ins.md).)</span><span class="sxs-lookup"><span data-stu-id="d78ef-162">(To determine which browser is being used by the add-in, see [Browsers used by Office Add-ins](../concepts/browsers-used-by-office-web-add-ins.md).)</span></span>

### <a name="13006"></a><span data-ttu-id="d78ef-163">13006</span><span class="sxs-lookup"><span data-stu-id="d78ef-163">13006</span></span>

<span data-ttu-id="d78ef-164">Erro do Cliente.</span><span class="sxs-lookup"><span data-stu-id="d78ef-164">Client Error.</span></span> <span data-ttu-id="d78ef-165">Este erro somente aparece no **Office na Web**.</span><span class="sxs-lookup"><span data-stu-id="d78ef-165">This error is only seen in **Office on the web**.</span></span> <span data-ttu-id="d78ef-166">Seu código deve sugerir que o usuário saia e reinicie a sessão do Office no navegador.</span><span class="sxs-lookup"><span data-stu-id="d78ef-166">Your code should suggest that the user sign out and then restart the Office browser session.</span></span>

### <a name="13007"></a><span data-ttu-id="d78ef-167">13007</span><span class="sxs-lookup"><span data-stu-id="d78ef-167">13007</span></span>

<span data-ttu-id="d78ef-168">O host do Office não conseguiu obter um token de acesso ao serviço Web do suplemento.</span><span class="sxs-lookup"><span data-stu-id="d78ef-168">The Office host was unable to get an access token to the add-in's web service.</span></span>

- <span data-ttu-id="d78ef-169">Se ocorrer este erro durante o desenvolvimento, certifique-se de que o registro e o manifesto do suplemento especifiquem as permissões de `profile` (e a permissão de `openid`, se estiver usando o MSAL.NET).</span><span class="sxs-lookup"><span data-stu-id="d78ef-169">If this error occurs during development, be sure that your add-in registration and add-in manifest specify the `profile` permission (and the `openid` permission, if you are using MSAL.NET).</span></span> <span data-ttu-id="d78ef-170">Para mais informações, confira [Registrar o suplemento com o ponto de extremidade do Microsoft Azure AD v2.0](register-sso-add-in-aad-v2.md).</span><span class="sxs-lookup"><span data-stu-id="d78ef-170">For more information, see [Register the add-in with Azure AD v2.0 endpoint](register-sso-add-in-aad-v2.md).</span></span>
- <span data-ttu-id="d78ef-171">Na produção, há várias coisas que podem causar esse erro.</span><span class="sxs-lookup"><span data-stu-id="d78ef-171">In production, there are several things that can cause this error.</span></span> <span data-ttu-id="d78ef-172">Algumas delas são:</span><span class="sxs-lookup"><span data-stu-id="d78ef-172">Some of them are:</span></span>
    - <span data-ttu-id="d78ef-173">O usuário tem uma identidade da conta da Microsoft (MSA).</span><span class="sxs-lookup"><span data-stu-id="d78ef-173">The user has a Microsoft Account (MSA) identity.</span></span>
    - <span data-ttu-id="d78ef-174">Algumas situações que poderiam causar um dos outros erros do 13xxx com uma conta de educação ou de trabalho do Microsoft 365 causarão um 13007 quando um MSA for usado.</span><span class="sxs-lookup"><span data-stu-id="d78ef-174">Some situations that would cause one of the other 13xxx errors with a Microsoft 365 Education or work account will cause a 13007 when a MSA is used.</span></span>

  <span data-ttu-id="d78ef-175">Em todos esses casos, o código deve retornar a um sistema alternativo de autenticação de usuário.</span><span class="sxs-lookup"><span data-stu-id="d78ef-175">For all of these cases, your code should fall back to an alternate system of user authentication.</span></span>

### <a name="13008"></a><span data-ttu-id="d78ef-176">13008</span><span class="sxs-lookup"><span data-stu-id="d78ef-176">13008</span></span>

<span data-ttu-id="d78ef-177">O usuário desencadeou uma operação que chama o `getAccessToken` antes de uma chamada anterior do `getAccessToken` concluída.</span><span class="sxs-lookup"><span data-stu-id="d78ef-177">The user triggered an operation that calls `getAccessToken` before a previous call of `getAccessToken` completed.</span></span> <span data-ttu-id="d78ef-178">Este erro somente aparece no **Office na Web**.</span><span class="sxs-lookup"><span data-stu-id="d78ef-178">This error is only seen on **Office on the web**.</span></span> <span data-ttu-id="d78ef-179">O código deve solicitar ao usuário que repita a operação após a conclusão da operação anterior.</span><span class="sxs-lookup"><span data-stu-id="d78ef-179">Your code should ask the user to repeat the operation after the previous operation has completed.</span></span>

### <a name="13010"></a><span data-ttu-id="d78ef-180">13010</span><span class="sxs-lookup"><span data-stu-id="d78ef-180">13010</span></span>

<span data-ttu-id="d78ef-181">O usuário está executando o suplemento no Office, no Microsoft Edge ou no Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="d78ef-181">The user is running the add-in in Office on Microsoft Edge or Internet Explorer.</span></span> <span data-ttu-id="d78ef-182">O domínio do Microsoft 365 do usuário e o `login.microsoftonline.com` domínio estão em zonas de segurança diferentes nas configurações do navegador.</span><span class="sxs-lookup"><span data-stu-id="d78ef-182">The user's Microsoft 365 domain, and the `login.microsoftonline.com` domain, are in a different security zones in the browser settings.</span></span> <span data-ttu-id="d78ef-183">Este erro somente aparece no **Office na Web**.</span><span class="sxs-lookup"><span data-stu-id="d78ef-183">This error is only seen on **Office on the web**.</span></span> <span data-ttu-id="d78ef-184">Se esse erro for retornado, o usuário já terá visto uma mensagem explicando o erro e vinculando a uma página sobre como alterar a configuração da zona.</span><span class="sxs-lookup"><span data-stu-id="d78ef-184">If this error is returned, the user will have already seen an error explaining this and linking to a page about how to change the zone configuration.</span></span> <span data-ttu-id="d78ef-185">Se o seu suplemento fornece funções que não exigem que o usuário esteja conectado, o código deve capturar esse erro e permitir que o suplemento permaneça em execução.</span><span class="sxs-lookup"><span data-stu-id="d78ef-185">If your add-in provides functions that don't require the user to be signed in, then your code should catch this error and allow the add-in to stay running.</span></span>

### <a name="13012"></a><span data-ttu-id="d78ef-186">13012</span><span class="sxs-lookup"><span data-stu-id="d78ef-186">13012</span></span>

<span data-ttu-id="d78ef-187">Há várias causas possíveis:</span><span class="sxs-lookup"><span data-stu-id="d78ef-187">There are several possible causes:</span></span>

- <span data-ttu-id="d78ef-188">O suplemento está em execução em uma plataforma não dá suporte à API `getAccessToken`.</span><span class="sxs-lookup"><span data-stu-id="d78ef-188">The add-in is running on a platform that does not support the `getAccessToken` API.</span></span> <span data-ttu-id="d78ef-189">Por exemplo, ele não é suportado no iPad.</span><span class="sxs-lookup"><span data-stu-id="d78ef-189">For example, it is not supported on iPad.</span></span> <span data-ttu-id="d78ef-190">Confira também [Conjuntos de requisitos da API de Identidade](../reference/requirement-sets/identity-api-requirement-sets.md).</span><span class="sxs-lookup"><span data-stu-id="d78ef-190">See also [Identity API Requirement Sets](../reference/requirement-sets/identity-api-requirement-sets.md).</span></span>
- <span data-ttu-id="d78ef-191">A opção `forMSGraphAccess` foi passada na chamada ao `getAccessToken` e o usuário obteve o suplemento no AppSource.</span><span class="sxs-lookup"><span data-stu-id="d78ef-191">The `forMSGraphAccess` option was passed in the call to `getAccessToken` and the user obtained the add-in from AppSource.</span></span> <span data-ttu-id="d78ef-192">Nesse cenário, o administrador do locatário não deu o consentimento ao suplemento para os escopos (permissões) do Microsoft Graph necessários.</span><span class="sxs-lookup"><span data-stu-id="d78ef-192">In this scenario, the tenant admin has not granted consent to the add-in for the Microsoft Graph scopes (permissions) that it needs.</span></span> <span data-ttu-id="d78ef-193">Uma nova chamada ao `getAccessToken` com o `allowConsentPrompt`, não resolverá o problema porque o Office poderá solicitar ao usuário o consentimento apenas para o escopo AAD do `profile`.</span><span class="sxs-lookup"><span data-stu-id="d78ef-193">Recalling `getAccessToken` with the `allowConsentPrompt` will not solve the problem because Office is allowed to prompt the user for consent to only the AAD `profile` scope.</span></span>

<span data-ttu-id="d78ef-194">O código deve retornar a um sistema alternativo de autenticação de usuário.</span><span class="sxs-lookup"><span data-stu-id="d78ef-194">Your code should fall back to an alternate system of user authentication.</span></span>

<span data-ttu-id="d78ef-195">No desenvolvimento, o suplemento é sideloaded no Outlook e a opção `forMSGraphAccess` foi passada na chamada ao `getAccessToken`.</span><span class="sxs-lookup"><span data-stu-id="d78ef-195">In development, the add-in is sideloaded in Outlook and the `forMSGraphAccess` option was passed in the call to `getAccessToken`.</span></span>

### <a name="13013"></a><span data-ttu-id="d78ef-196">13013</span><span class="sxs-lookup"><span data-stu-id="d78ef-196">13013</span></span>

<span data-ttu-id="d78ef-197">O `getAccessToken` era chamado muitas vezes em um curto período de tempo, portanto, o Office limitou a chamada mais recente.</span><span class="sxs-lookup"><span data-stu-id="d78ef-197">The `getAccessToken` was called too many times in a short amount of time, so Office throttled the most recent call.</span></span> <span data-ttu-id="d78ef-198">Isso geralmente é causado por um loop infinito de chamadas para o método.</span><span class="sxs-lookup"><span data-stu-id="d78ef-198">This is usually caused by an infinite loop of calls to the method.</span></span> <span data-ttu-id="d78ef-199">Há situações em que se rechamar o método é aconselhável.</span><span class="sxs-lookup"><span data-stu-id="d78ef-199">There are scenarios when recalling the method is advisable.</span></span> <span data-ttu-id="d78ef-200">No entanto, seu código deve usar uma variável de contador ou sinalizador para garantir que o método não seja rechamado repetidamente.</span><span class="sxs-lookup"><span data-stu-id="d78ef-200">However, your code should use a counter or flag variable to ensure that the method is not recalled repeatedly.</span></span> <span data-ttu-id="d78ef-201">Se o mesmo caminho de código de "repetição" estiver em execução novamente, o código deverá retornar a um sistema alternativo de autenticação do usuário.</span><span class="sxs-lookup"><span data-stu-id="d78ef-201">If the same "retry" code path is running again, the code should fall back to an alternate system of user authentication.</span></span> <span data-ttu-id="d78ef-202">Para obter um exemplo de código, consulte como a `retryGetAccessToken` variável é usada em [HomeES6.js](https://github.com/OfficeDev/Office-Add-in-ASPNET-SSO/blob/master/Complete/Office-Add-in-ASPNET-SSO-WebAPI/Scripts/HomeES6.js) ou [ssoAuthES6.js](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO/blob/master/Complete/public/javascripts/ssoAuthES6.js).</span><span class="sxs-lookup"><span data-stu-id="d78ef-202">For a code example, see how the `retryGetAccessToken` variable is used in [HomeES6.js](https://github.com/OfficeDev/Office-Add-in-ASPNET-SSO/blob/master/Complete/Office-Add-in-ASPNET-SSO-WebAPI/Scripts/HomeES6.js) or [ssoAuthES6.js](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO/blob/master/Complete/public/javascripts/ssoAuthES6.js).</span></span>

### <a name="50001"></a><span data-ttu-id="d78ef-203">50001</span><span class="sxs-lookup"><span data-stu-id="d78ef-203">50001</span></span>

<span data-ttu-id="d78ef-204">Este erro (que não é específico de `getAccessToken`) pode indicar que o navegador colocou um cópia antiga dos arquivos office.js em cache.</span><span class="sxs-lookup"><span data-stu-id="d78ef-204">This error (which is not specific to `getAccessToken`) may indicate that the browser has cached an old copy of the office.js files.</span></span> <span data-ttu-id="d78ef-205">Quando você estiver desenvolvendo, limpe o cache do navegador.</span><span class="sxs-lookup"><span data-stu-id="d78ef-205">When you are developing, clear the browser's cache.</span></span> <span data-ttu-id="d78ef-206">Também é possível que a versão do Office não esteja suficientemente recente para dar suporte à SSO.</span><span class="sxs-lookup"><span data-stu-id="d78ef-206">Another possibility is that the version of Office is not recent enough to support SSO.</span></span> <span data-ttu-id="d78ef-207">No Windows, a versão mínima é a 16.0.12215.20006.</span><span class="sxs-lookup"><span data-stu-id="d78ef-207">On Windows, the minimum version is 16.0.12215.20006.</span></span> <span data-ttu-id="d78ef-208">No Mac, é a 16.32.19102902.</span><span class="sxs-lookup"><span data-stu-id="d78ef-208">On Mac, it is 16.32.19102902.</span></span>

<span data-ttu-id="d78ef-209">Em um suplemento de produção, o suplemento deverá responder a esse erro recorrendo a um sistema de autenticação de usuário alternativo.</span><span class="sxs-lookup"><span data-stu-id="d78ef-209">In a production add-in, the add-in should respond to this error by falling back to an alternate system of user authentication.</span></span> <span data-ttu-id="d78ef-210">Para obter mais informações, confira [Requisitos e Melhores Práticas](../develop/sso-in-office-add-ins.md#requirements-and-best-practices).</span><span class="sxs-lookup"><span data-stu-id="d78ef-210">For more information, see [Requirements and Best Practices](../develop/sso-in-office-add-ins.md#requirements-and-best-practices).</span></span>

## <a name="errors-on-the-server-side-from-azure-active-directory"></a><span data-ttu-id="d78ef-211">Erros no lado do servidor do Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="d78ef-211">Errors on the server-side from Azure Active Directory</span></span>

<span data-ttu-id="d78ef-212">Para exemplos do tratamento de erro descritos nesta seção, confira:</span><span class="sxs-lookup"><span data-stu-id="d78ef-212">For samples of the error-handling described in this section, see:</span></span>
- [<span data-ttu-id="d78ef-213">Office-Add-in-ASPNET-SSO</span><span class="sxs-lookup"><span data-stu-id="d78ef-213">Office-Add-in-ASPNET-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-ASPNET-SSO)
- [<span data-ttu-id="d78ef-214">Office-Add-in-NodeJS-SSO</span><span class="sxs-lookup"><span data-stu-id="d78ef-214">Office-Add-in-NodeJS-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO)

### <a name="conditional-access--multifactor-authentication-errors"></a><span data-ttu-id="d78ef-215">Erros no acesso condicional/autenticação multifatorial</span><span class="sxs-lookup"><span data-stu-id="d78ef-215">Conditional access / Multifactor authentication errors</span></span>

<span data-ttu-id="d78ef-216">Em determinadas configurações de identidade no AAD e no Microsoft 365, é possível que alguns recursos possam ser acessados com o Microsoft Graph para exigir a autenticação multifator (MFA), mesmo quando o Microsoft 365 do usuário não.</span><span class="sxs-lookup"><span data-stu-id="d78ef-216">In certain configurations of identity in AAD and Microsoft 365, it is possible for some resources that are accessible with Microsoft Graph to require multifactor authentication (MFA), even when the user's Microsoft 365 tenancy does not.</span></span> <span data-ttu-id="d78ef-217">Quando o AAD recebe uma solicitação de um token para o recurso protegido por MFA, através do fluxo Em Nome De, ele retorna ao serviço Web do seu suplemento uma mensagem JSON que contém uma propriedade `claims`.</span><span class="sxs-lookup"><span data-stu-id="d78ef-217">When AAD receives a request for a token to the MFA-protected resource, via the on-behalf-of flow, it returns to your add-in's web service a JSON message that contains a `claims` property.</span></span> <span data-ttu-id="d78ef-218">A propriedade de reivindicações tem informações sobre quais outros fatores de autenticação são necessários.</span><span class="sxs-lookup"><span data-stu-id="d78ef-218">The claims property has information about what further authentication factors are needed.</span></span>

<span data-ttu-id="d78ef-219">O código deve testar essa propriedade de `claims`.</span><span class="sxs-lookup"><span data-stu-id="d78ef-219">Your code should test for this `claims` property.</span></span> <span data-ttu-id="d78ef-220">Dependendo da arquitetura do seu suplemento, você poderá testá-lo no lado do cliente ou testá-lo no lado do servidor e retransmiti-lo ao cliente.</span><span class="sxs-lookup"><span data-stu-id="d78ef-220">Depending on your add-in's architecture, you may test for it on the client-side, or you may test for it on the server-side and relay it to the client.</span></span> <span data-ttu-id="d78ef-221">Você precisa dessa informação no cliente porque o Office processa a autenticação para os suplementos de SSO. Se você retransmiti-lo do lado do servidor, a mensagem para o cliente pode ser um erro (como `500 Server Error` ou `401 Unauthorized`) ou estar no corpo de uma resposta de sucesso (como `200 OK`).</span><span class="sxs-lookup"><span data-stu-id="d78ef-221">You need this information in the client because Office handles authentication for SSO add-ins. If you relay it from the server-side, the message to the client can be either an error (such as `500 Server Error` or `401 Unauthorized`) or in the body of a success response (such as `200 OK`).</span></span> <span data-ttu-id="d78ef-222">Em ambos os casos, o retorno de chamada (falha ou sucesso) da chamada AJAX do lado do cliente do seu código para a API da Web do seu suplemento deve testar essa resposta.</span><span class="sxs-lookup"><span data-stu-id="d78ef-222">In either case, the (failure or success) callback of your code's client-side AJAX call to your add-in's web API should test for this response.</span></span> 

<span data-ttu-id="d78ef-223">Independentemente da arquitetura, se o valor de declarações tiver sido enviado do AAD, seu código deverá se lembrar `getAccessToken` e passar a opção `authChallenge: CLAIMS-STRING-HERE` no `options` parâmetro.</span><span class="sxs-lookup"><span data-stu-id="d78ef-223">Regardless of your architecture, if the claims value has been sent from AAD, your code should recall `getAccessToken` and pass the option `authChallenge: CLAIMS-STRING-HERE` in the `options` parameter.</span></span> <span data-ttu-id="d78ef-224">Quando o AAD vir essa string, ele solicitará ao usuário os fatores adicionais e retornará um novo token de acesso que será aceito no fluxo Em Nome De.</span><span class="sxs-lookup"><span data-stu-id="d78ef-224">When AAD sees this string, it prompts the user for the additional factor(s) and then returns a new access token which will be accepted in the on-behalf-of flow.</span></span>

### <a name="consent-missing-errors"></a><span data-ttu-id="d78ef-225">Erros de falta de consentimento</span><span class="sxs-lookup"><span data-stu-id="d78ef-225">Consent missing errors</span></span>

<span data-ttu-id="d78ef-226">Se o AAD não tiver um registro de que o consentimento (para o recurso Microsoft Graph) foi concedido ao suplemento pelo usuário (ou administrador do locatário), o AAD enviará uma mensagem de erro ao seu serviço Web.</span><span class="sxs-lookup"><span data-stu-id="d78ef-226">If AAD has no record that consent (to the Microsoft Graph resource) was granted to the add-in by the user (or tenant administrator), AAD will send an error message to your web service.</span></span> <span data-ttu-id="d78ef-227">Seu código deve dizer ao cliente (no corpo de uma resposta `403 Forbidden`, por exemplo).</span><span class="sxs-lookup"><span data-stu-id="d78ef-227">Your code must tell the client (in the body of a `403 Forbidden` response, for example).</span></span>

<span data-ttu-id="d78ef-228">Se o suplemento precisar de escopos do Microsoft Graph que só possam ser consentidos por um administrador, seu código deverá gerar um erro.</span><span class="sxs-lookup"><span data-stu-id="d78ef-228">If the add-in needs Microsoft Graph scopes that can only be consented to by an admin, your code should throw an error.</span></span> <span data-ttu-id="d78ef-229">Se os únicos escopos necessários puderem ser consentidos pelo usuário, o código deverá retornar a um sistema alternativo de autenticação de usuário.</span><span class="sxs-lookup"><span data-stu-id="d78ef-229">If the only scopes that are needed can be consented to by the user, then your code should fall back to an alternate system of user authentication.</span></span>

### <a name="invalid-or-missing-scope-permission-errors"></a><span data-ttu-id="d78ef-230">Erros de escopos (permissões) inválidos ou ausentes</span><span class="sxs-lookup"><span data-stu-id="d78ef-230">Invalid or missing scope (permission) errors</span></span>

<span data-ttu-id="d78ef-231">Esse tipo de erro só deve aparecer no desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="d78ef-231">This kind of error should only be seen in development.</span></span>

- <span data-ttu-id="d78ef-232">Seu código do lado do servidor deve enviar a resposta `403 Forbidden` ao cliente, que deve registrar o erro no console ou gravá-lo em um log.</span><span class="sxs-lookup"><span data-stu-id="d78ef-232">Your server-side code should send a `403 Forbidden` response to the client which should log the error to the console or record it in a log.</span></span>
- <span data-ttu-id="d78ef-233">Verifique se a seção de [Escopos](../reference/manifest/scopes.md) do manifesto do suplemento especifica todas as permissões necessárias.</span><span class="sxs-lookup"><span data-stu-id="d78ef-233">Be sure your add-in manifest [Scopes](../reference/manifest/scopes.md) section specifies all needed permissions.</span></span> <span data-ttu-id="d78ef-234">E certifique-se de que seu registro do serviço Web do suplemento especifique as mesmas permissões.</span><span class="sxs-lookup"><span data-stu-id="d78ef-234">And be sure your registration of the add-in's web service specifies the same permissions.</span></span> <span data-ttu-id="d78ef-235">Verifique também os erros de ortografia.</span><span class="sxs-lookup"><span data-stu-id="d78ef-235">Check for spelling mistakes too.</span></span> <span data-ttu-id="d78ef-236">Para mais informações, confira [Registrar o suplemento com o ponto de extremidade do Microsoft Azure AD v2.0](register-sso-add-in-aad-v2.md).</span><span class="sxs-lookup"><span data-stu-id="d78ef-236">For more information, see [Register the add-in with Azure AD v2.0 endpoint](register-sso-add-in-aad-v2.md).</span></span>

### <a name="invalid-audience-error-in-the-access-token-not-the-bootstrap-token"></a><span data-ttu-id="d78ef-237">Erro de audiência inválido no token de acesso (não no token de inicialização)</span><span class="sxs-lookup"><span data-stu-id="d78ef-237">Invalid audience error in the access token (not the bootstrap token)</span></span>

<span data-ttu-id="d78ef-238">Seu código do lado do servidor deve enviar uma resposta `403 Forbidden` ao cliente que deve apresentar uma mensagem amigável ao usuário e, possivelmente, também registrar o erro no console ou gravá-lo em um registro.</span><span class="sxs-lookup"><span data-stu-id="d78ef-238">Your server-side code should send a `403 Forbidden` response to the client which should present a friendly message to the user and possibly also log the error to the console or record it in a log.</span></span>
