---
title: Evite usar o método Context. Sync em loops
description: Saiba como usar o loop de divisão e os padrões de objetos correlacionados para evitar chamar Context. Sync em um loop.
ms.date: 04/09/2020
localization_priority: Normal
ms.openlocfilehash: 0f967b07b3ccf323321779676021c53c81102f83
ms.sourcegitcommit: 76552b3e5725d9112c772595971b922c295e6b4c
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/10/2020
ms.locfileid: "43225982"
---
# <a name="avoid-using-the-contextsync-method-in-loops"></a><span data-ttu-id="5f1e1-103">Evite usar o método Context. Sync em loops</span><span class="sxs-lookup"><span data-stu-id="5f1e1-103">Avoid using the context.sync method in loops</span></span>

> [!NOTE]
> <span data-ttu-id="5f1e1-104">Este artigo pressupõe que você está além do estágio inicial do trabalho com pelo menos uma das quatro APIs&mdash;JavaScript do Office específicas do host para Excel, Word, OneNote e Visio&mdash;que usam um sistema de lote para interagir com o documento do Office.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-104">This article assumes that you're beyond the beginning stage of working with at least one of the four host-specific Office JavaScript APIs&mdash;for Excel, Word, OneNote, and Visio&mdash;that use a batch system to interact with the Office document.</span></span> <span data-ttu-id="5f1e1-105">Em particular, você deve saber o que é uma `context.sync` chamada e deve saber o que é um objeto de coleção.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-105">In particular, you should know what a call of `context.sync` does and you should know what a collection object is.</span></span> <span data-ttu-id="5f1e1-106">Se você não estiver nesse estágio, comece a [entender a API JavaScript do Office](../develop/understanding-the-javascript-api-for-office.md) e a documentação vinculada a em "específico do host", neste artigo.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-106">If you're not at that stage, please start with [Understanding the Office JavaScript API](../develop/understanding-the-javascript-api-for-office.md) and the documentation linked to under "host-specific" in that article.</span></span>

<span data-ttu-id="5f1e1-107">Para alguns cenários de programação nos suplementos do Office que usam um dos modelos de API específicos do host (para Excel, Word, OneNote e Visio), seu código precisa ler, gravar ou processar algumas propriedades de cada membro de um objeto coleção.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-107">For some programming scenarios in Office Add-ins that use one of the host-specific API models (for Excel, Word, OneNote, and Visio), your code needs to read, write, or process some property from every member of a collection object.</span></span> <span data-ttu-id="5f1e1-108">Por exemplo, um suplemento do Excel que precisa obter os valores de cada célula de uma determinada coluna de tabela ou um suplemento do Word que precisa realçar cada instância de uma cadeia de caracteres no documento.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-108">For example, an Excel add-in that needs to get the values of every cell in a particular table column or a Word add-in that needs to highlight every instance of a string in the document.</span></span> <span data-ttu-id="5f1e1-109">Você precisa iterar sobre os membros na `items` Propriedade do objeto coleção; Mas, por motivos de desempenho, você precisa evitar chamadas `context.sync` em cada iteração do loop.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-109">You need to iterate over the members in the `items` property of the collection object; but, for performance reasons, you need to avoid calling `context.sync` in every iteration of the loop.</span></span> <span data-ttu-id="5f1e1-110">Cada chamada de `context.sync` é uma viagem de ida e volta do suplemento para o documento do Office.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-110">Every call of `context.sync` is a round trip from the add-in to the Office document.</span></span> <span data-ttu-id="5f1e1-111">Repetidas viagens de ida e volta o desempenho, especialmente se o suplemento estiver sendo executado no Office na Web, pois os ciclos de ida e volta passam pela Internet.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-111">Repeated round trips hurt performance, especially if the add-in is running in Office on the web because the round trips go across the internet.</span></span>

> [!NOTE]
> <span data-ttu-id="5f1e1-112">Todos os exemplos neste artigo usam `for` loops, mas as práticas descritas aplicam-se a qualquer instrução de loop que possa percorrer uma matriz, incluindo o seguinte:</span><span class="sxs-lookup"><span data-stu-id="5f1e1-112">All examples in this article use `for` loops but the practices described apply to any loop statement that can iterate through an array, including the following:</span></span>
>
> - `for`
> - `for of`
> - `while`
> - `do while`
> 
> <span data-ttu-id="5f1e1-113">Eles também se aplicam a qualquer método de matriz para o qual uma função é passada e aplicada aos itens na matriz, incluindo o seguinte:</span><span class="sxs-lookup"><span data-stu-id="5f1e1-113">They also apply to any array method to which a function is passed and applied to the items in the array, including the following:</span></span>
>
> - `Array.every`
> - `Array.forEach`
> - `Array.filter`
> - `Array.find`
> - `Array.findIndex`
> - `Array.map`
> - `Array.reduce`
> - `Array.reduceRight`
> - `Array.some`

## <a name="writing-to-the-document"></a><span data-ttu-id="5f1e1-114">Gravação no documento</span><span class="sxs-lookup"><span data-stu-id="5f1e1-114">Writing to the document</span></span>

<span data-ttu-id="5f1e1-115">No caso mais simples, você está apenas gravando para membros de um objeto de coleção, não lendo suas propriedades.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-115">In the simplest case, you are only writing to members of a collection object, not reading their properties.</span></span> <span data-ttu-id="5f1e1-116">Por exemplo, o código a seguir é realçado em amarelo a cada instância de "a" em um documento do Word.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-116">For example, the following code highlights in yellow every instance of "the" in a Word document.</span></span> 

> [!NOTE]
> <span data-ttu-id="5f1e1-117">Geralmente, `context.sync` é uma boa prática ter um ponto final antes do caractere de fechamento "}" do método host `run` (como `Excel.run`, `Word.run`etc.).</span><span class="sxs-lookup"><span data-stu-id="5f1e1-117">It is generally a good practice to put have a final `context.sync` just before the closing "}" character of the host `run` method (such as `Excel.run`, `Word.run`, etc.).</span></span> <span data-ttu-id="5f1e1-118">Isso ocorre porque o `run` método faz uma chamada oculta do `context.sync` como a última coisa que faz se, e somente se, houver comandos em fila que ainda não tenham sido sincronizados.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-118">This is because the `run` method makes a hidden call of `context.sync` as the last thing it does if, and only if, there are queued commands that have not yet been synchronized.</span></span> <span data-ttu-id="5f1e1-119">O fato de esta chamada ser oculta pode ser confuso, portanto, geralmente recomendamos que você adicione o `context.sync`explícito.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-119">The fact that this call is hidden can be confusing, so we generally recommend that you add the explicit `context.sync`.</span></span> <span data-ttu-id="5f1e1-120">No entanto, Considerando que este artigo está prestes a minimizar `context.sync`as chamadas, é, na verdade, mais confuso de adicionar `context.sync`um final totalmente desnecessário.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-120">However, given that this article is about minimizing calls of `context.sync`, it is actually more confusing to add an entirely unnecessary final `context.sync`.</span></span> <span data-ttu-id="5f1e1-121">Portanto, neste artigo, deixamos de existir quando não há comandos não sincronizados no final do `run`.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-121">So, in this article, we leave it out when there are no unsynchronized commands at the end of the `run`.</span></span> 

```javascript
Word.run(async function (context) {
    let startTime, endTime;
    const docBody = context.document.body;

    // search() returns an array of Ranges.
    const searchResults = docBody.search('the', { matchWholeWord: true });
    context.load(searchResults, 'items');
    await context.sync();

    // Record the system time.
    startTime = performance.now();

    for (var i = 0; i < searchResults.items.length; i++) {
      searchResults.items[i].font.highlightColor = '#FFFF00';

      await context.sync(); // SYNCHRONIZE IN EACH ITERATION
    }
    
    // await context.sync(); // SYNCHRONIZE AFTER THE LOOP

    // Record the system time again then calculate how long the operation took.
    endTime = performance.now();
    console.log("The operation took: " + (endTime - startTime) + " milliseconds.");
  })
}
```

<span data-ttu-id="5f1e1-122">O código anterior levou 1 segundo para concluir em um documento com 200 instâncias de "The" no Word no Windows.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-122">The preceding code took 1 full second to complete in a document with 200 instances of "the" in Word on Windows.</span></span> <span data-ttu-id="5f1e1-123">Mas quando a `await context.sync();` linha dentro do loop é comentada e a mesma linha após o loop é descomentado, a operação levou apenas 1/10 de um segundo.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-123">But when the `await context.sync();` line inside the loop is commented out and the same line just after the loop is uncommented, the operation took only a 1/10th of a second.</span></span> <span data-ttu-id="5f1e1-124">No Word na Web (com borda como o navegador), levou 3 segundos completos à sincronização dentro do loop e somente 6/décimos de segundo com a sincronização após o loop, cerca de cinco vezes mais velozes.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-124">In Word on the web (with Edge as the browser), it took 3 full seconds with the synchronization inside the loop and only 6/10ths of a second with the synchronization after the loop, about five times faster.</span></span> <span data-ttu-id="5f1e1-125">Em um documento com 2000 instâncias de "a", ele levou (no Word na Web) 80 segundos com a sincronização dentro do loop e apenas 4 segundos com a sincronização após o loop, cerca de 20 vezes mais veloz.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-125">In a document with 2000 instances of "the", it took (in Word on the web) 80 seconds with the synchronization inside the loop and only 4 seconds with the synchronization after the loop, about 20 times faster.</span></span>

> [!NOTE]
> <span data-ttu-id="5f1e1-126">Vale a pena perguntar se a versão de sincronização no loop será executada mais rapidamente se as sincronizações foram executadas simultaneamente, o que poderia ser feito simplesmente removendo a `await` palavra-chave da parte frontal do. `context.sync()`</span><span class="sxs-lookup"><span data-stu-id="5f1e1-126">It's worth asking whether the synchronize-inside-the-loop version would execute faster if the synchronizations ran concurrently, which could be done by simply removing the `await` keyword from the front of the `context.sync()`.</span></span> <span data-ttu-id="5f1e1-127">Isso fará com que o tempo de execução inicie a sincronização e, em seguida, inicie imediatamente a próxima iteração do loop sem aguardar a conclusão da sincronização.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-127">This would cause the runtime to initiate the synchronization and then immediately start the next iteration of the loop without waiting for the synchronization to complete.</span></span> <span data-ttu-id="5f1e1-128">No entanto, isso não é uma boa solução como se `context.sync` fosse movimentar o loop completo por esses motivos:</span><span class="sxs-lookup"><span data-stu-id="5f1e1-128">However, this is not as good a solution as moving the `context.sync` out of the loop entirely for these reasons:</span></span>
>
> - <span data-ttu-id="5f1e1-129">Assim como os comandos em um trabalho em lotes de sincronização são enfileirados, os trabalhos em lotes em si são colocados na fila no Office, mas o Office não dá suporte a mais de 50 trabalhos em lote na fila.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-129">Just as the commands in a synchronization batch job are queued, the batch jobs themselves are queued in Office, but Office supports no more than 50 batch jobs in the queue.</span></span> <span data-ttu-id="5f1e1-130">Mais erros de gatilho.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-130">Any more triggers errors.</span></span> <span data-ttu-id="5f1e1-131">Portanto, se houver mais de 50 iterações em um loop, haverá uma chance de que o tamanho da fila seja excedido.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-131">So, if there are more than 50 iterations in a loop, there is a chance that the queue size is exceeded.</span></span> <span data-ttu-id="5f1e1-132">Quanto maior o número de iterações, maior a chance de isso acontecer.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-132">The greater the number of iterations, the greater the chance of this happening.</span></span> 
> - <span data-ttu-id="5f1e1-133">"Simultâneo" não significa simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-133">"Concurrently" does not mean simultaneously.</span></span> <span data-ttu-id="5f1e1-134">Ainda será mais demorado executar várias operações de sincronização do que executar uma.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-134">It would still take longer to execute multiple synchronization operations than to execute one.</span></span>
> - <span data-ttu-id="5f1e1-135">Não é garantido que as operações simultâneas sejam concluídas na mesma ordem em que foram iniciadas.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-135">Concurrent operations are not guaranteed to complete in the same order in which they started.</span></span> <span data-ttu-id="5f1e1-136">No exemplo anterior, não importa a ordem em que a palavra "a" é realçada, mas há situações em que é importante que os itens da coleção sejam processados na ordem.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-136">In the preceding example, it doesn't matter what order the  word "the" gets highlighted, but there are scenarios where it's important that the items in the collection be processed in order.</span></span>

## <a name="reading-values-from-the-document-with-the-split-loop-pattern"></a><span data-ttu-id="5f1e1-137">Ler valores do documento com o padrão de loop dividido</span><span class="sxs-lookup"><span data-stu-id="5f1e1-137">Reading values from the document with the split loop pattern</span></span>

<span data-ttu-id="5f1e1-138">A `context.sync`prevenção de s dentro de um loop se torna mais desafiador quando o código deve *ler* uma propriedade dos itens da coleção à medida que processa cada um.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-138">Avoiding `context.sync`s inside a loop becomes more challenging when the code must *read* a property of the collection items as it processes each one.</span></span> <span data-ttu-id="5f1e1-139">Suponha que seu código precise iterar todos os controles de conteúdo em um documento do Word e registre o texto do primeiro parágrafo associado a cada controle.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-139">Suppose your code needs to iterate all the content controls in a Word document and log the text of the first paragraph associated with each control.</span></span> <span data-ttu-id="5f1e1-140">Seus instintos de programação podem levar você a fazer um loop sobre os `text` controles, carregar a propriedade de cada parágrafo ( `context.sync` primeiro), chamar o preenchimento do objeto de parágrafo de proxy com o texto do documento e, em seguida, fazê-lo.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-140">Your programming instincts might lead you to loop over the controls, load the `text` property of each (first) paragraph, call `context.sync` to populate the proxy paragraph object with the text from the document, and then log it.</span></span> <span data-ttu-id="5f1e1-141">Apresentamos um exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-141">The following is an example.</span></span>

```javascript
Word.run(async (context) => {
    const contentControls = context.document.contentControls.load('items');
    await context.sync();

    for (let i = 0; i < contentControls.items.length; i++) {
      const paragraph = contentControls.items[i].getRange('Whole').paragraphs.getFirst();
      paragraph.load('text');
      await context.sync();
      console.log(paragraph.text);
    }
});
```

<span data-ttu-id="5f1e1-142">Neste cenário, para evitar ter um `context.sync` loop, você deve usar um padrão que chamamos o padrão de **loop dividido** .</span><span class="sxs-lookup"><span data-stu-id="5f1e1-142">In this scenario, to avoid having a `context.sync` in a loop, you should use a pattern we call the **split loop** pattern.</span></span> <span data-ttu-id="5f1e1-143">Vamos ver um exemplo concreto do padrão antes de obtermos uma descrição formal dele.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-143">Let's see a concrete example of the pattern before we get to a formal description of it.</span></span> <span data-ttu-id="5f1e1-144">Veja como o padrão de loop dividido pode ser aplicado ao trecho de código anterior.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-144">Here's how the split loop pattern can be applied to the preceding code snippet.</span></span> <span data-ttu-id="5f1e1-145">Observe o seguinte sobre este código:</span><span class="sxs-lookup"><span data-stu-id="5f1e1-145">Note the following about this code:</span></span>

- <span data-ttu-id="5f1e1-146">Agora há dois loops e o `context.sync` vêm entre eles, portanto, não há nenhum `context.sync` loop.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-146">There are now two loops and the `context.sync` comes between them, so there's no `context.sync` inside either loop.</span></span>
- <span data-ttu-id="5f1e1-147">O primeiro `text` loop itera através dos itens no objeto da coleção e carrega a propriedade da mesma forma que o loop original, mas o primeiro loop não pode registrar o texto do parágrafo porque ele não contém `context.sync` mais um para `text` popular a propriedade `paragraph` do objeto proxy.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-147">The first loop iterates through the items in the collection object and loads the `text` property just as the original loop did, but the first loop cannot log the paragraph text because it no longer contains a `context.sync` to populate the `text` property of the `paragraph` proxy object.</span></span> <span data-ttu-id="5f1e1-148">Em vez disso, ele `paragraph` adiciona o objeto a uma matriz.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-148">Instead, it adds the `paragraph` object to an array.</span></span>
- <span data-ttu-id="5f1e1-149">O segundo loop itera através da matriz que foi criada pelo primeiro loop e registra o `text` de cada `paragraph` item.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-149">The second loop iterates through the array that was created by the first loop, and logs the `text` of each `paragraph` item.</span></span> <span data-ttu-id="5f1e1-150">Isso é possível porque o `context.sync` que vem entre os dois loops preencheram todas `text` as propriedades.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-150">This is possible because the `context.sync` that came between the two loops populated all the `text` properties.</span></span>

```javascript
Word.run(async (context) => {
    const contentControls = context.document.contentControls.load("items");
    await context.sync();

    const firstParagraphsOfCCs = [];
    for (let i = 0; i < contentControls.items.length; i++) {
      const paragraph = contentControls.items[i].getRange('Whole').paragraphs.getFirst();
      paragraph.load('text');
      firstParagraphsOfCCs.push(paragraph);
    }

    await context.sync();

    for (let i = 0; i < firstParagraphsOfCCs.length; i++) {
      console.log(firstParagraphsOfCCs[i].text);
    }
});
```

<span data-ttu-id="5f1e1-151">O exemplo anterior sugere o procedimento a seguir para transformar um loop que contenha um `context.sync` no padrão de loop dividido:</span><span class="sxs-lookup"><span data-stu-id="5f1e1-151">The preceding example suggests the following procedure for turning a loop that contains a `context.sync` into the split loop pattern:</span></span> 

1. <span data-ttu-id="5f1e1-152">Substitua o loop por dois loops.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-152">Replace the loop with two loops.</span></span>
2. <span data-ttu-id="5f1e1-153">Crie um primeiro loop para iterar sobre a coleção e adicione cada item a uma matriz enquanto também estiver carregando qualquer Propriedade do item que seu código precisa ler.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-153">Create a first loop to iterate over the collection and add each item to an array while also loading any property of the item that your code needs to read.</span></span> 
3. <span data-ttu-id="5f1e1-154">Após o primeiro loop, chame `context.sync` para preencher os objetos de proxy com todas as propriedades carregadas.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-154">Following the first loop, call `context.sync` to populate the proxy objects with any loaded properties.</span></span> 
4. <span data-ttu-id="5f1e1-155">Siga as `context.sync` instruções com um segundo loop para iterar sobre a matriz criada no primeiro loop e ler as propriedades carregadas.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-155">Follow the `context.sync` with a second loop to iterate over the array created in the first loop and read the loaded properties.</span></span>

## <a name="processing-objects-in-the-document-with-the-correlated-objects-pattern"></a><span data-ttu-id="5f1e1-156">Processamento de objetos no documento com o padrão de objetos correlacionados</span><span class="sxs-lookup"><span data-stu-id="5f1e1-156">Processing objects in the document with the correlated objects pattern</span></span>

<span data-ttu-id="5f1e1-157">Consideremos um cenário mais complexo em que o processamento dos itens na coleção requer dados que não estão nos próprios itens.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-157">Let's consider a more complex scenario where processing the items in the collection requires data that isn't in the items themselves.</span></span> <span data-ttu-id="5f1e1-158">O cenário prevê um suplemento do Word que opera em documentos criados a partir de um modelo com texto clichê.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-158">The scenario envisions a Word add-in that operates on documents created from a template with some boilerplate text.</span></span> <span data-ttu-id="5f1e1-159">Dispersa no texto são uma ou mais instâncias das seguintes cadeias de caracteres de espaço reservado: "{Coordinator}", "{Deputy}" e "{Manager}".</span><span class="sxs-lookup"><span data-stu-id="5f1e1-159">Scattered in the text are one or more instances of the following placeholder strings: "{Coordinator}", "{Deputy}", and "{Manager}".</span></span> <span data-ttu-id="5f1e1-160">O suplemento substitui cada espaço reservado pelo nome de algumas pessoas.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-160">The add-in replaces each placeholder with some person's name.</span></span> <span data-ttu-id="5f1e1-161">A interface do usuário do suplemento não é importante para este artigo.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-161">The UI of the add-in is not important to this article.</span></span> <span data-ttu-id="5f1e1-162">Por exemplo, ele pode ter um painel de tarefas com três caixas de texto, cada uma rotulada com um dos espaços reservados.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-162">For example, it could have a task pane with three text boxes, each labeled with one of the placeholders.</span></span> <span data-ttu-id="5f1e1-163">O usuário insere um nome em cada caixa de texto e, em seguida, pressiona um botão **substituir** .</span><span class="sxs-lookup"><span data-stu-id="5f1e1-163">The user enters a name in each text box and then presses a **Replace** button.</span></span> <span data-ttu-id="5f1e1-164">O manipulador para o botão cria uma matriz que mapeia os nomes para os espaços reservados e, em seguida, substitui cada espaço reservado pelo nome atribuído.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-164">The handler for the button creates an array that maps the names to the placeholders, and then replaces each placeholder with the assigned name.</span></span> 

<span data-ttu-id="5f1e1-165">Você não precisa realmente produzir um suplemento com esta interface do usuário para experimentar o código.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-165">You don't need to actually produce an add-in with this UI to experiment with the code.</span></span> <span data-ttu-id="5f1e1-166">Você pode usar a [ferramenta de laboratório de script para criar](../overview/explore-with-script-lab.md) um protótipo do código importante.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-166">You can use the [Script Lab tool](../overview/explore-with-script-lab.md) to prototype the important code.</span></span> <span data-ttu-id="5f1e1-167">Use a instrução de atribuição a seguir para criar a matriz de mapeamento.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-167">Use the following assignment statement to create the mapping array.</span></span>

```javascript
const jobMapping = [
        { job: "{Coordinator}", person: "Sally" },
        { job: "{Deputy}", person: "Bob" },
        { job: "{Manager}", person: "Kim" }
    ];
```

<span data-ttu-id="5f1e1-168">O código a seguir mostra como você pode substituir cada espaço reservado por seu nome atribuído, `context.sync` se você usou dentro de loops.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-168">The following code shows how you might replace each placeholder with its assigned name if you used `context.sync` inside loops.</span></span>

```javascript
Word.run(async (context) => {

    for (let i = 0; i < jobMapping.length; i++) {
      let options = Word.SearchOptions.newObject(context);
      options.matchWildCards = false;
      let searchResults = context.document.body.search(jobMapping[i].job, options);
      searchResults.load('items');

      await context.sync(); 

      for (let j = 0; j < searchResults.items.length; j++) {
        searchResults.items[j].insertText(jobMapping[i].person, Word.InsertLocation.replace);

        await context.sync();
      }
    }
});
```

<span data-ttu-id="5f1e1-169">No código anterior, há um loop externo e interno.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-169">In the preceding code, there is an outer and an inner loop.</span></span> <span data-ttu-id="5f1e1-170">Cada uma delas contém um `context.sync`.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-170">Each of them contains a `context.sync`.</span></span> <span data-ttu-id="5f1e1-171">Com base no primeiro trecho de código deste artigo, provavelmente você verá que o `context.sync` loop interno pode ser movido após o loop interno.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-171">Based on the very first code snippet in this article, you probably see that the `context.sync` in the inner loop can simply be moved after the inner loop.</span></span> <span data-ttu-id="5f1e1-172">Mas isso ainda deixaria o código com um `context.sync` (dois deles na verdade) no loop externo.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-172">But that would still leave the code with a `context.sync` (two of them actually) in the outer loop.</span></span> <span data-ttu-id="5f1e1-173">O código a seguir mostra como você pode `context.sync` remover dos loops.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-173">The following code shows how you can remove `context.sync` from the loops.</span></span> <span data-ttu-id="5f1e1-174">Discutimos o código a seguir.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-174">We discuss the code below.</span></span>

```javascript
Word.run(async (context) => {

    const allSearchResults = [];
    for (let i = 0; i < jobMapping.length; i++) {
      let options = Word.SearchOptions.newObject(context);
      options.matchWildCards = false;
      let searchResults = context.document.body.search(jobMapping[i].job, options);
      searchResults.load('items');
      let correlatedSearchResult = {
        rangesMatchingJob: searchResults,
        personAssignedToJob: jobMapping[i].person
      }
      allSearchResults.push(correlatedSearchResult);
    }

    await context.sync()

    for (let i = 0; i < allSearchResults.length; i++) {
      let correlatedObject = allSearchResults[i];

      for (let j = 0; j < correlatedObject.rangesMatchingJob.items.length; j++) {        
        let targetRange = correlatedObject.rangesMatchingJob.items[j];
        let name = correlatedObject.personAssignedToJob;
        targetRange.insertText(name, Word.InsertLocation.replace);
      }
    }

    await context.sync();
});
```

<span data-ttu-id="5f1e1-175">Observação o código usa o padrão de loop dividido:</span><span class="sxs-lookup"><span data-stu-id="5f1e1-175">Note the code uses the split loop pattern:</span></span>

- <span data-ttu-id="5f1e1-176">O loop externo do exemplo anterior foi dividido em dois.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-176">The outer loop from the preceding example has been split into two.</span></span> <span data-ttu-id="5f1e1-177">(O segundo loop tem um loop interno, que é esperado porque o código está em iteração em um conjunto de trabalhos (ou espaços reservados) e dentro desse conjunto que está Iterando nos intervalos correspondentes.)</span><span class="sxs-lookup"><span data-stu-id="5f1e1-177">(The second loop has an inner loop, which is expected because the code is iterating over a set of jobs (or placeholders) and within that set it is iterating over the matching ranges.)</span></span>
- <span data-ttu-id="5f1e1-178">Há um `context.sync` após cada loop principal, mas não `context.sync` dentro de nenhum loop.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-178">There is a `context.sync` after each major loop, but no `context.sync` inside any loop.</span></span> 
- <span data-ttu-id="5f1e1-179">O segundo loop principal itera por meio de uma matriz criada no primeiro loop.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-179">The second major loop iterates through an array that is created in the first loop.</span></span>

<span data-ttu-id="5f1e1-180">Mas a matriz criada no primeiro loop *não contém apenas* um objeto do Office como o primeiro loop fazia na seção [lendo valores do documento com o padrão de loop dividido](#reading-values-from-the-document-with-the-split-loop-pattern).</span><span class="sxs-lookup"><span data-stu-id="5f1e1-180">But the array created in the first loop does *not* contain only an Office object as the first loop did in the section [Reading values from the document with the split loop pattern](#reading-values-from-the-document-with-the-split-loop-pattern).</span></span> <span data-ttu-id="5f1e1-181">Isso ocorre porque algumas das informações necessárias para processar os objetos de intervalo do Word não estão nos próprios objetos Range, mas, em vez `jobMapping` disso, vêm da matriz.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-181">This is because some of the information needed to process the Word Range objects is not in the Range objects themselves but instead comes from the `jobMapping` array.</span></span> 

<span data-ttu-id="5f1e1-182">Portanto, os objetos na matriz criados no primeiro loop são objetos personalizados que têm duas propriedades.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-182">So, the objects in the array created in the first loop are custom objects that have two properties.</span></span> <span data-ttu-id="5f1e1-183">O primeiro é uma matriz de intervalos de palavras que correspondem a um título de trabalho específico (ou seja, uma cadeia de caracteres de espaço reservado) e a segunda é uma cadeia de caracteres que fornece o nome da pessoa atribuída ao trabalho.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-183">The first is an array of Word Ranges that match a specific job title (that is, a placeholder string) and the second is a string that provides the name of the person assigned to the job.</span></span> <span data-ttu-id="5f1e1-184">Isso torna o loop final fácil de escrever e fácil de ler, pois todas as informações necessárias para processar um determinado intervalo estão contidas no mesmo objeto personalizado que contém o intervalo.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-184">This makes the final loop easy to write and easy to read because all of the information needed to process a given range is contained in the same custom object that contains the range.</span></span> <span data-ttu-id="5f1e1-185">O nome que deve substituir _ **correlatedObject**. rangesMatchingJob. Items [j]_ é a outra Propriedade do mesmo objeto: _ **correlatedObject**. personAssignedToJob_.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-185">The name that should replace _**correlatedObject**.rangesMatchingJob.items[j]_ is the other property of the same object: _**correlatedObject**.personAssignedToJob_.</span></span> 

<span data-ttu-id="5f1e1-186">Chamamos essa variação do padrão de loop dividido do padrão de **objetos correlacionados** .</span><span class="sxs-lookup"><span data-stu-id="5f1e1-186">We call this variation of the split loop pattern the **correlated objects** pattern.</span></span> <span data-ttu-id="5f1e1-187">A idéia geral é que o primeiro loop cria uma matriz de objetos personalizados.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-187">The general idea is that the first loop creates an array of custom objects.</span></span> <span data-ttu-id="5f1e1-188">Cada objeto tem uma propriedade cujo valor é um dos itens em um objeto do conjunto do Office (ou uma matriz desses itens).</span><span class="sxs-lookup"><span data-stu-id="5f1e1-188">Each object has a property whose value is one of the items in an Office collection object (or an array of such items).</span></span> <span data-ttu-id="5f1e1-189">O objeto personalizado tem outras propriedades, cada uma das quais fornece informações necessárias para processar os objetos do Office no loop final.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-189">The custom object has other properties, each of which provides information needed to process the Office objects in the final loop.</span></span> <span data-ttu-id="5f1e1-190">Consulte a seção [outros exemplos desses padrões](#other-examples-of-these-patterns) para obter um link para um exemplo em que o objeto correlacionáe personalizado tem mais de duas propriedades.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-190">See the section [Other examples of these patterns](#other-examples-of-these-patterns) for a link to an example where the custom correlating object has more than two properties.</span></span>

<span data-ttu-id="5f1e1-191">Uma restrição adicional: às vezes, leva mais de um loop apenas para criar a matriz de objetos correlacionados personalizados.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-191">One further caveat: sometimes it takes more than one loop just to create the array of custom correlating objects.</span></span> <span data-ttu-id="5f1e1-192">Isso pode acontecer se você precisar ler uma propriedade de cada membro de um objeto do conjunto do Office apenas para coletar informações que serão usadas para processar outro objeto de coleção.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-192">This can happen if you need to read a property of each member of one Office collection object just to gather information that will be used to process another collection object.</span></span> <span data-ttu-id="5f1e1-193">(Por exemplo, seu código precisa ler os títulos de todas as colunas em uma tabela do Excel porque seu suplemento aplicará um formato de número às células de algumas colunas com base no título dessa coluna.) Mas você sempre pode manter o `context.sync`s entre os loops, e não um loop.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-193">(For example, your code needs to read the titles of all the columns in an Excel table because your add-in is going to apply a number format to the cells of some columns based on that column's title.) But you can always keep the `context.sync`s between the loops, rather than in a loop.</span></span> <span data-ttu-id="5f1e1-194">Consulte a seção [outros exemplos desses padrões](#other-examples-of-these-patterns) para obter um exemplo.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-194">See the section [Other examples of these patterns](#other-examples-of-these-patterns) for an example.</span></span>

## <a name="other-examples-of-these-patterns"></a><span data-ttu-id="5f1e1-195">Outros exemplos desses padrões</span><span class="sxs-lookup"><span data-stu-id="5f1e1-195">Other examples of these patterns</span></span>

- <span data-ttu-id="5f1e1-196">Para obter um exemplo muito simples para o Excel `Array.forEach` que usa loops, consulte a resposta aceita para esta pilha de excedente: [é possível enfileirar mais de um contexto. Load antes de Context. Sync?](https://stackoverflow.com/questions/44459604/is-it-possible-to-queue-more-than-one-context-load-before-context-sync)</span><span class="sxs-lookup"><span data-stu-id="5f1e1-196">For a very simple example for Excel that uses `Array.forEach` loops, see the accepted answer to this Stack Overflow question: [Is it possible to queue more than one context.load before context.sync?](https://stackoverflow.com/questions/44459604/is-it-possible-to-queue-more-than-one-context-load-before-context-sync)</span></span>
- <span data-ttu-id="5f1e1-197">Para obter um exemplo simples para o Word `Array.forEach` que usa loops e `async` / `await` não usa a sintaxe, consulte a resposta aceita para esta pilha de excedente: [iterar sobre todos os parágrafos com controles de conteúdo com a API JavaScript do Office](https://stackoverflow.com/questions/58422113/iterating-over-all-paragraphs-with-content-controls-with-office-javascript-api).</span><span class="sxs-lookup"><span data-stu-id="5f1e1-197">For a simple example for Word that uses `Array.forEach` loops and doesn't use `async`/`await` syntax, see the accepted answer to this Stack Overflow question: [Iterating over all paragraphs with content controls with Office JavaScript API](https://stackoverflow.com/questions/58422113/iterating-over-all-paragraphs-with-content-controls-with-office-javascript-api).</span></span>
- <span data-ttu-id="5f1e1-198">Para obter um exemplo do Word que está escrito em TypeScript, confira o suplemento do Word de exemplo [Angular2 de estilo](https://github.com/OfficeDev/Word-Add-in-Angular2-StyleChecker), especialmente o arquivo [Word. Document. Service. TS](https://github.com/OfficeDev/Word-Add-in-Angular2-StyleChecker/blob/master/app/services/word-document/word.document.service.ts).</span><span class="sxs-lookup"><span data-stu-id="5f1e1-198">For an example for Word that is written in TypeScript, see the sample [Word Add-in Angular2 Style Checker](https://github.com/OfficeDev/Word-Add-in-Angular2-StyleChecker), especially the file [word.document.service.ts](https://github.com/OfficeDev/Word-Add-in-Angular2-StyleChecker/blob/master/app/services/word-document/word.document.service.ts).</span></span> <span data-ttu-id="5f1e1-199">Ele tem uma mistura `for` e `Array.forEach` loops.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-199">It has a mixture of `for` and `Array.forEach` loops.</span></span>
- <span data-ttu-id="5f1e1-200">Para obter um exemplo avançado de palavra, importe [essa essência](https://gist.github.com/9c5a803e52480ec7f00bb3224292e0ab) para a [ferramenta de laboratório de scripts](../overview/explore-with-script-lab.md).</span><span class="sxs-lookup"><span data-stu-id="5f1e1-200">For an advanced Word sample, import [this gist](https://gist.github.com/9c5a803e52480ec7f00bb3224292e0ab) into the [Script Lab tool](../overview/explore-with-script-lab.md).</span></span> <span data-ttu-id="5f1e1-201">Para o contexto no uso da essência, confira a resposta aceita para o documento de pergunta de estouro de pilha [não sincronizado após substituir o texto](https://stackoverflow.com/questions/48227941/document-not-in-sync-after-replace-text).</span><span class="sxs-lookup"><span data-stu-id="5f1e1-201">For context in using the gist, see the accepted answer to the Stack Overflow question [Document not in sync after replace text](https://stackoverflow.com/questions/48227941/document-not-in-sync-after-replace-text).</span></span> <span data-ttu-id="5f1e1-202">Este exemplo cria um tipo de objeto correlacionado personalizado que tem três propriedades.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-202">This sample creates a custom correlating object type that has three properties.</span></span> <span data-ttu-id="5f1e1-203">Ele usa um total de três loops para construir a matriz de objetos correlacionados e dois loops para fazer o processamento final.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-203">It uses a total of three loops to construct the array of correlated objects, and two more loops to do the final processing.</span></span> <span data-ttu-id="5f1e1-204">Há uma mistura de `for` e `Array.forEach` loops.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-204">There are a mixture of `for` and `Array.forEach` loops.</span></span>
- <span data-ttu-id="5f1e1-205">Embora não seja estritamente um exemplo dos padrões de loop de divisão ou objetos correlacionados, há um exemplo avançado do Excel que mostra como converter um conjunto de valores de célula em outras moedas com apenas `context.sync`um único.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-205">Although not strictly an example of the split loop or correlated objects patterns, there is an advanced Excel sample that shows how to convert a set of cell values to other currencies with just a single `context.sync`.</span></span> <span data-ttu-id="5f1e1-206">Para experimentá-lo, abra a [ferramenta de laboratório de script](../overview/explore-with-script-lab.md) e navegue até o exemplo de conversor de **moeda** .</span><span class="sxs-lookup"><span data-stu-id="5f1e1-206">To try it, open the [Script Lab tool](../overview/explore-with-script-lab.md) and navigate to the **Currency Converter** sample.</span></span> 

## <a name="when-should-you-not-use-the-patterns-in-this-article"></a><span data-ttu-id="5f1e1-207">Quando você *não* deve usar os padrões neste artigo?</span><span class="sxs-lookup"><span data-stu-id="5f1e1-207">When should you *not* use the patterns in this article?</span></span>

<span data-ttu-id="5f1e1-208">O Excel não pode ler mais de 5 MB de dados em uma determinada `context.sync`chamada de.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-208">Excel cannot read more than 5 MB of data in a given call of `context.sync`.</span></span> <span data-ttu-id="5f1e1-209">Se esse limite for excedido, um erro será gerado.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-209">If this limit is exceeded, an error is thrown.</span></span> <span data-ttu-id="5f1e1-210">(Para obter mais informações, consulte [limites de transferência de dados do Excel](../develop/common-coding-issues.md#excel-data-transfer-limits).) É muito raro que esse limite seja abordado, mas se houver uma chance de que isso aconteça com seu suplemento, o código *não* deverá carregar todos os dados em um único loop e seguir o loop com um `context.sync`.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-210">(For more information, see [Excel data transfer limits](../develop/common-coding-issues.md#excel-data-transfer-limits).) It is very rare that this limit is approached, but if there's a chance that this will happen with your add-in, then your code should *not* load all the data in a single loop and follow the loop with a `context.sync`.</span></span> <span data-ttu-id="5f1e1-211">Mas você ainda deve evitar ter um `context.sync` em cada iteração de um loop sobre um objeto de coleção.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-211">But you still should avoid having a `context.sync` in every iteration of a loop over a collection object.</span></span> <span data-ttu-id="5f1e1-212">Em vez disso, defina subconjuntos dos itens na coleção e execute o loop sobre cada subconjunto por `context.sync` vez, com um entre os loops.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-212">Instead, define subsets of the items in the collection and loop over each subset in turn, with a `context.sync` between the loops.</span></span> <span data-ttu-id="5f1e1-213">Você pode estruturar isso com um loop externo que se repete nos subconjuntos e contém `context.sync` o em cada uma dessas iterações externas.</span><span class="sxs-lookup"><span data-stu-id="5f1e1-213">You could structure this with an outer loop that iterates over the subsets and contains the `context.sync` in each of these outer iterations.</span></span>
