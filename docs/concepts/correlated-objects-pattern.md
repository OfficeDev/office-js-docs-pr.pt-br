---
title: Evite usar o método context.sync em loops
description: Saiba como usar o loop dividido e os padrões de objetos correlacionados para evitar chamar context.sync em um loop.
ms.date: 07/29/2020
localization_priority: Normal
ms.openlocfilehash: 64cfd5cd350746ba07e1a98986a4bd7811431475
ms.sourcegitcommit: 883f71d395b19ccfc6874a0d5942a7016eb49e2c
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/09/2021
ms.locfileid: "53349137"
---
# <a name="avoid-using-the-contextsync-method-in-loops"></a><span data-ttu-id="814ee-103">Evite usar o método context.sync em loops</span><span class="sxs-lookup"><span data-stu-id="814ee-103">Avoid using the context.sync method in loops</span></span>

> [!NOTE]
> <span data-ttu-id="814ee-104">Este artigo supõe que você esteja além do estágio inicial de trabalhar com pelo menos uma das quatro APIs JavaScript específicas do Office aplicativo para Excel, Word, OneNote e Visio que usam um sistema em lotes para interagir com o &mdash; &mdash; documento Office.</span><span class="sxs-lookup"><span data-stu-id="814ee-104">This article assumes that you're beyond the beginning stage of working with at least one of the four application-specific Office JavaScript APIs&mdash;for Excel, Word, OneNote, and Visio&mdash;that use a batch system to interact with the Office document.</span></span> <span data-ttu-id="814ee-105">Em particular, você deve saber o que uma chamada `context.sync` faz e deve saber o que é um objeto de coleção.</span><span class="sxs-lookup"><span data-stu-id="814ee-105">In particular, you should know what a call of `context.sync` does and you should know what a collection object is.</span></span> <span data-ttu-id="814ee-106">Se você não estiver nesse estágio, comece com Understanding [the Office API JavaScript](../develop/understanding-the-javascript-api-for-office.md) e a documentação vinculada em "específico do aplicativo" nesse artigo.</span><span class="sxs-lookup"><span data-stu-id="814ee-106">If you're not at that stage, please start with [Understanding the Office JavaScript API](../develop/understanding-the-javascript-api-for-office.md) and the documentation linked to under "application-specific" in that article.</span></span>

<span data-ttu-id="814ee-107">Para alguns cenários de programação em Office Add-ins que usam um dos modelos de API específicos do aplicativo (para Excel, Word, OneNote e Visio), seu código precisa ler, gravar ou processar alguma propriedade de cada membro de um objeto de coleção.</span><span class="sxs-lookup"><span data-stu-id="814ee-107">For some programming scenarios in Office Add-ins that use one of the application-specific API models (for Excel, Word, OneNote, and Visio), your code needs to read, write, or process some property from every member of a collection object.</span></span> <span data-ttu-id="814ee-108">Por exemplo, um Excel que precisa obter os valores de cada célula em uma coluna de tabela específica ou um complemento do Word que precisa realçar cada instância de uma cadeia de caracteres no documento.</span><span class="sxs-lookup"><span data-stu-id="814ee-108">For example, an Excel add-in that needs to get the values of every cell in a particular table column or a Word add-in that needs to highlight every instance of a string in the document.</span></span> <span data-ttu-id="814ee-109">Você precisa iterar sobre os membros na propriedade do objeto da coleção; mas, por motivos de desempenho, você precisa evitar chamar em cada `items` `context.sync` iteração do loop.</span><span class="sxs-lookup"><span data-stu-id="814ee-109">You need to iterate over the members in the `items` property of the collection object; but, for performance reasons, you need to avoid calling `context.sync` in every iteration of the loop.</span></span> <span data-ttu-id="814ee-110">Cada chamada de é uma viagem de ida e volta do `context.sync` add-in para o Office documento.</span><span class="sxs-lookup"><span data-stu-id="814ee-110">Every call of `context.sync` is a round trip from the add-in to the Office document.</span></span> <span data-ttu-id="814ee-111">Viagens de ida e volta repetidas prejudicam o desempenho, especialmente se o add-in estiver em execução Office na Web porque as idas e voltas vão pela Internet.</span><span class="sxs-lookup"><span data-stu-id="814ee-111">Repeated round trips hurt performance, especially if the add-in is running in Office on the web because the round trips go across the internet.</span></span>

> [!NOTE]
> <span data-ttu-id="814ee-112">Todos os exemplos neste artigo usam loops, mas as práticas descritas se aplicam a qualquer instrução de loop que possa iterar através de uma `for` matriz, incluindo o seguinte:</span><span class="sxs-lookup"><span data-stu-id="814ee-112">All examples in this article use `for` loops but the practices described apply to any loop statement that can iterate through an array, including the following:</span></span>
>
> - `for`
> - `for of`
> - `while`
> - `do while`
> 
> <span data-ttu-id="814ee-113">Eles também se aplicam a qualquer método de matriz ao qual uma função é passada e aplicada aos itens na matriz, incluindo o seguinte:</span><span class="sxs-lookup"><span data-stu-id="814ee-113">They also apply to any array method to which a function is passed and applied to the items in the array, including the following:</span></span>
>
> - `Array.every`
> - `Array.forEach`
> - `Array.filter`
> - `Array.find`
> - `Array.findIndex`
> - `Array.map`
> - `Array.reduce`
> - `Array.reduceRight`
> - `Array.some`

## <a name="writing-to-the-document"></a><span data-ttu-id="814ee-114">Escrevendo no documento</span><span class="sxs-lookup"><span data-stu-id="814ee-114">Writing to the document</span></span>

<span data-ttu-id="814ee-115">No caso mais simples, você só está escrevendo para membros de um objeto de coleção, não lendo suas propriedades.</span><span class="sxs-lookup"><span data-stu-id="814ee-115">In the simplest case, you are only writing to members of a collection object, not reading their properties.</span></span> <span data-ttu-id="814ee-116">Por exemplo, o código a seguir realça em amarelo todas as instâncias de "o" em um documento do Word.</span><span class="sxs-lookup"><span data-stu-id="814ee-116">For example, the following code highlights in yellow every instance of "the" in a Word document.</span></span>

> [!NOTE]
> <span data-ttu-id="814ee-117">Geralmente, é uma boa prática colocar ter uma final pouco antes do caractere "}" de fechamento do método de aplicativo `context.sync` `run` (como `Excel.run` , , `Word.run` etc.).</span><span class="sxs-lookup"><span data-stu-id="814ee-117">It is generally a good practice to put have a final `context.sync` just before the closing "}" character of the application `run` method (such as `Excel.run`, `Word.run`, etc.).</span></span> <span data-ttu-id="814ee-118">Isso acontece porque o método faz uma chamada oculta como a última coisa que ele faz se, e somente se, há comandos em fila que ainda não `run` `context.sync` foram sincronizados.</span><span class="sxs-lookup"><span data-stu-id="814ee-118">This is because the `run` method makes a hidden call of `context.sync` as the last thing it does if, and only if, there are queued commands that have not yet been synchronized.</span></span> <span data-ttu-id="814ee-119">O fato de essa chamada estar oculta pode ser confuso, portanto, geralmente recomendamos que você adicione o `context.sync` explícito .</span><span class="sxs-lookup"><span data-stu-id="814ee-119">The fact that this call is hidden can be confusing, so we generally recommend that you add the explicit `context.sync`.</span></span> <span data-ttu-id="814ee-120">No entanto, considerando que este artigo se trata de minimizar chamadas de , na verdade, é mais confuso adicionar um `context.sync` final totalmente `context.sync` desnecessário.</span><span class="sxs-lookup"><span data-stu-id="814ee-120">However, given that this article is about minimizing calls of `context.sync`, it is actually more confusing to add an entirely unnecessary final `context.sync`.</span></span> <span data-ttu-id="814ee-121">Portanto, neste artigo, o deixamos de fora quando não há comandos não sincronizados no final do `run` .</span><span class="sxs-lookup"><span data-stu-id="814ee-121">So, in this article, we leave it out when there are no unsynchronized commands at the end of the `run`.</span></span>

```javascript
Word.run(async function (context) {
    let startTime, endTime;
    const docBody = context.document.body;

    // search() returns an array of Ranges.
    const searchResults = docBody.search('the', { matchWholeWord: true });
    context.load(searchResults, 'items');
    await context.sync();

    // Record the system time.
    startTime = performance.now();

    for (var i = 0; i < searchResults.items.length; i++) {
      searchResults.items[i].font.highlightColor = '#FFFF00';

      await context.sync(); // SYNCHRONIZE IN EACH ITERATION
    }
    
    // await context.sync(); // SYNCHRONIZE AFTER THE LOOP

    // Record the system time again then calculate how long the operation took.
    endTime = performance.now();
    console.log("The operation took: " + (endTime - startTime) + " milliseconds.");
  })
}
```

<span data-ttu-id="814ee-122">O código anterior levou 1 segundo completo para ser concluído em um documento com 200 instâncias de "o" no Word no Windows.</span><span class="sxs-lookup"><span data-stu-id="814ee-122">The preceding code took 1 full second to complete in a document with 200 instances of "the" in Word on Windows.</span></span> <span data-ttu-id="814ee-123">Mas quando a linha dentro do loop é comentada para fora e a mesma linha logo após o loop ser descomentado, a operação levou apenas um décimo de `await context.sync();` segundo.</span><span class="sxs-lookup"><span data-stu-id="814ee-123">But when the `await context.sync();` line inside the loop is commented out and the same line just after the loop is uncommented, the operation took only a 1/10th of a second.</span></span> <span data-ttu-id="814ee-124">No Word na Web (com Edge como navegador), levou 3 segundos completos com a sincronização dentro do loop e apenas 6/10ths de um segundo com a sincronização após o loop, cerca de cinco vezes mais rápido.</span><span class="sxs-lookup"><span data-stu-id="814ee-124">In Word on the web (with Edge as the browser), it took 3 full seconds with the synchronization inside the loop and only 6/10ths of a second with the synchronization after the loop, about five times faster.</span></span> <span data-ttu-id="814ee-125">Em um documento com 2.000 instâncias de "the", ele levou (em Word na Web) 80 segundos com a sincronização dentro do loop e apenas 4 segundos com a sincronização após o loop, cerca de 20 vezes mais rápido.</span><span class="sxs-lookup"><span data-stu-id="814ee-125">In a document with 2000 instances of "the", it took (in Word on the web) 80 seconds with the synchronization inside the loop and only 4 seconds with the synchronization after the loop, about 20 times faster.</span></span>

> [!NOTE]
> <span data-ttu-id="814ee-126">Vale a pena perguntar se a versão de sincronização dentro do loop seria executada mais rapidamente se as sincronizações fosse executadas simultaneamente, o que poderia ser feito simplesmente removendo a palavra-chave da frente do `await` `context.sync()` .</span><span class="sxs-lookup"><span data-stu-id="814ee-126">It's worth asking whether the synchronize-inside-the-loop version would execute faster if the synchronizations ran concurrently, which could be done by simply removing the `await` keyword from the front of the `context.sync()`.</span></span> <span data-ttu-id="814ee-127">Isso faria com que o tempo de execução iniciasse a sincronização e iniciasse imediatamente a próxima iteração do loop sem aguardar a conclusão da sincronização.</span><span class="sxs-lookup"><span data-stu-id="814ee-127">This would cause the runtime to initiate the synchronization and then immediately start the next iteration of the loop without waiting for the synchronization to complete.</span></span> <span data-ttu-id="814ee-128">No entanto, essa solução não é tão boa quanto mover completamente o `context.sync` loop por esses motivos:</span><span class="sxs-lookup"><span data-stu-id="814ee-128">However, this is not as good a solution as moving the `context.sync` out of the loop entirely for these reasons:</span></span>
>
> - <span data-ttu-id="814ee-129">Assim como os comandos em um trabalho em lotes de sincronização são enfilados, os trabalhos em lotes em si são enfilados no Office, mas o Office dá suporte a não mais de 50 trabalhos em lotes na fila.</span><span class="sxs-lookup"><span data-stu-id="814ee-129">Just as the commands in a synchronization batch job are queued, the batch jobs themselves are queued in Office, but Office supports no more than 50 batch jobs in the queue.</span></span> <span data-ttu-id="814ee-130">Mais erros disparam.</span><span class="sxs-lookup"><span data-stu-id="814ee-130">Any more triggers errors.</span></span> <span data-ttu-id="814ee-131">Portanto, se houver mais de 50 iterações em um loop, há uma chance de que o tamanho da fila seja excedido.</span><span class="sxs-lookup"><span data-stu-id="814ee-131">So, if there are more than 50 iterations in a loop, there is a chance that the queue size is exceeded.</span></span> <span data-ttu-id="814ee-132">Quanto maior o número de iterações, maior será a chance de isso acontecer.</span><span class="sxs-lookup"><span data-stu-id="814ee-132">The greater the number of iterations, the greater the chance of this happening.</span></span> 
> - <span data-ttu-id="814ee-133">"Simultaneamente" não significa simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="814ee-133">"Concurrently" does not mean simultaneously.</span></span> <span data-ttu-id="814ee-134">Ainda levaria mais tempo para executar várias operações de sincronização do que executar uma.</span><span class="sxs-lookup"><span data-stu-id="814ee-134">It would still take longer to execute multiple synchronization operations than to execute one.</span></span>
> - <span data-ttu-id="814ee-135">Operações simultâneas não são garantidas na mesma ordem em que iniciaram.</span><span class="sxs-lookup"><span data-stu-id="814ee-135">Concurrent operations are not guaranteed to complete in the same order in which they started.</span></span> <span data-ttu-id="814ee-136">No exemplo anterior, não importa qual ordem a palavra "the" é realçada, mas há cenários em que é importante que os itens da coleção sejam processados em ordem.</span><span class="sxs-lookup"><span data-stu-id="814ee-136">In the preceding example, it doesn't matter what order the  word "the" gets highlighted, but there are scenarios where it's important that the items in the collection be processed in order.</span></span>

## <a name="reading-values-from-the-document-with-the-split-loop-pattern"></a><span data-ttu-id="814ee-137">Lendo valores do documento com o padrão de loop dividido</span><span class="sxs-lookup"><span data-stu-id="814ee-137">Reading values from the document with the split loop pattern</span></span>

<span data-ttu-id="814ee-138">Evitar s dentro de um loop se torna mais desafiador quando o código deve ler uma propriedade dos itens da coleção à `context.sync` medida que processa cada um. </span><span class="sxs-lookup"><span data-stu-id="814ee-138">Avoiding `context.sync`s inside a loop becomes more challenging when the code must *read* a property of the collection items as it processes each one.</span></span> <span data-ttu-id="814ee-139">Suponha que seu código precise iterar todos os controles de conteúdo em um documento do Word e registrar o texto do primeiro parágrafo associado a cada controle.</span><span class="sxs-lookup"><span data-stu-id="814ee-139">Suppose your code needs to iterate all the content controls in a Word document and log the text of the first paragraph associated with each control.</span></span> <span data-ttu-id="814ee-140">Seus instintos de programação podem levar você a fazer um loop sobre os controles, carregar a propriedade de cada parágrafo (primeiro), chamar para preencher o objeto de parágrafo proxy com o texto do documento e, em `text` `context.sync` seguida, registrá-lo.</span><span class="sxs-lookup"><span data-stu-id="814ee-140">Your programming instincts might lead you to loop over the controls, load the `text` property of each (first) paragraph, call `context.sync` to populate the proxy paragraph object with the text from the document, and then log it.</span></span> <span data-ttu-id="814ee-141">Apresentamos um exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="814ee-141">The following is an example.</span></span>

```javascript
Word.run(async (context) => {
    const contentControls = context.document.contentControls.load('items');
    await context.sync();

    for (let i = 0; i < contentControls.items.length; i++) {
      const paragraph = contentControls.items[i].getRange('Whole').paragraphs.getFirst();
      paragraph.load('text');
      await context.sync();
      console.log(paragraph.text);
    }
});
```

<span data-ttu-id="814ee-142">Nesse cenário, para evitar ter um loop, você deve usar um padrão que chamamos de padrão de `context.sync` loop **dividido.**</span><span class="sxs-lookup"><span data-stu-id="814ee-142">In this scenario, to avoid having a `context.sync` in a loop, you should use a pattern we call the **split loop** pattern.</span></span> <span data-ttu-id="814ee-143">Vamos ver um exemplo concreto do padrão antes de chegarmos a uma descrição formal dele.</span><span class="sxs-lookup"><span data-stu-id="814ee-143">Let's see a concrete example of the pattern before we get to a formal description of it.</span></span> <span data-ttu-id="814ee-144">Veja como o padrão de loop dividido pode ser aplicado ao trecho de código anterior.</span><span class="sxs-lookup"><span data-stu-id="814ee-144">Here's how the split loop pattern can be applied to the preceding code snippet.</span></span> <span data-ttu-id="814ee-145">Observe o seguinte sobre este código.</span><span class="sxs-lookup"><span data-stu-id="814ee-145">Note the following about this code.</span></span>

- <span data-ttu-id="814ee-146">Agora há dois loops e o `context.sync` entre eles, portanto, não há `context.sync` nenhum loop dentro de ambos.</span><span class="sxs-lookup"><span data-stu-id="814ee-146">There are now two loops and the `context.sync` comes between them, so there's no `context.sync` inside either loop.</span></span>
- <span data-ttu-id="814ee-147">O primeiro loop itera pelos itens no objeto da coleção e carrega a propriedade da mesma forma que o loop original, mas o primeiro loop não pode registrar o texto do parágrafo porque ele não contém mais um para preencher a propriedade do objeto `text` `context.sync` `text` `paragraph` proxy.</span><span class="sxs-lookup"><span data-stu-id="814ee-147">The first loop iterates through the items in the collection object and loads the `text` property just as the original loop did, but the first loop cannot log the paragraph text because it no longer contains a `context.sync` to populate the `text` property of the `paragraph` proxy object.</span></span> <span data-ttu-id="814ee-148">Em vez disso, ele adiciona `paragraph` o objeto a uma matriz.</span><span class="sxs-lookup"><span data-stu-id="814ee-148">Instead, it adds the `paragraph` object to an array.</span></span>
- <span data-ttu-id="814ee-149">O segundo loop itera pela matriz criada pelo primeiro loop e registra `text` o de cada `paragraph` item.</span><span class="sxs-lookup"><span data-stu-id="814ee-149">The second loop iterates through the array that was created by the first loop, and logs the `text` of each `paragraph` item.</span></span> <span data-ttu-id="814ee-150">Isso é possível porque o `context.sync` que veio entre os dois loops preencheu todas as `text` propriedades.</span><span class="sxs-lookup"><span data-stu-id="814ee-150">This is possible because the `context.sync` that came between the two loops populated all the `text` properties.</span></span>

```javascript
Word.run(async (context) => {
    const contentControls = context.document.contentControls.load("items");
    await context.sync();

    const firstParagraphsOfCCs = [];
    for (let i = 0; i < contentControls.items.length; i++) {
      const paragraph = contentControls.items[i].getRange('Whole').paragraphs.getFirst();
      paragraph.load('text');
      firstParagraphsOfCCs.push(paragraph);
    }

    await context.sync();

    for (let i = 0; i < firstParagraphsOfCCs.length; i++) {
      console.log(firstParagraphsOfCCs[i].text);
    }
});
```

<span data-ttu-id="814ee-151">O exemplo anterior sugere o procedimento a seguir para transformar um loop que contém um `context.sync` no padrão de loop dividido.</span><span class="sxs-lookup"><span data-stu-id="814ee-151">The preceding example suggests the following procedure for turning a loop that contains a `context.sync` into the split loop pattern.</span></span>

1. <span data-ttu-id="814ee-152">Substitua o loop por dois loops.</span><span class="sxs-lookup"><span data-stu-id="814ee-152">Replace the loop with two loops.</span></span>
2. <span data-ttu-id="814ee-153">Crie um primeiro loop para iterar sobre a coleção e adicione cada item a uma matriz enquanto também carrega qualquer propriedade do item que seu código precisa ler.</span><span class="sxs-lookup"><span data-stu-id="814ee-153">Create a first loop to iterate over the collection and add each item to an array while also loading any property of the item that your code needs to read.</span></span>
3. <span data-ttu-id="814ee-154">Após o primeiro loop, chame `context.sync` para preencher os objetos proxy com quaisquer propriedades carregadas.</span><span class="sxs-lookup"><span data-stu-id="814ee-154">Following the first loop, call `context.sync` to populate the proxy objects with any loaded properties.</span></span>
4. <span data-ttu-id="814ee-155">Siga o `context.sync` com um segundo loop para iterar sobre a matriz criada no primeiro loop e ler as propriedades carregadas.</span><span class="sxs-lookup"><span data-stu-id="814ee-155">Follow the `context.sync` with a second loop to iterate over the array created in the first loop and read the loaded properties.</span></span>

## <a name="processing-objects-in-the-document-with-the-correlated-objects-pattern"></a><span data-ttu-id="814ee-156">Processar objetos no documento com o padrão de objetos correlacionados</span><span class="sxs-lookup"><span data-stu-id="814ee-156">Processing objects in the document with the correlated objects pattern</span></span>

<span data-ttu-id="814ee-157">Vamos considerar um cenário mais complexo em que o processamento dos itens na coleção exige dados que não estão nos itens em si.</span><span class="sxs-lookup"><span data-stu-id="814ee-157">Let's consider a more complex scenario where processing the items in the collection requires data that isn't in the items themselves.</span></span> <span data-ttu-id="814ee-158">O cenário visualiza um complemento do Word que opera em documentos criados a partir de um modelo com algum texto clichê.</span><span class="sxs-lookup"><span data-stu-id="814ee-158">The scenario envisions a Word add-in that operates on documents created from a template with some boilerplate text.</span></span> <span data-ttu-id="814ee-159">Espalhados no texto estão uma ou mais instâncias das seguintes cadeias de caracteres de espaço reservado: "{Coordenador}", "{Deputy}" e "{Manager}".</span><span class="sxs-lookup"><span data-stu-id="814ee-159">Scattered in the text are one or more instances of the following placeholder strings: "{Coordinator}", "{Deputy}", and "{Manager}".</span></span> <span data-ttu-id="814ee-160">O complemento substitui cada espaço reservado pelo nome de uma pessoa.</span><span class="sxs-lookup"><span data-stu-id="814ee-160">The add-in replaces each placeholder with some person's name.</span></span> <span data-ttu-id="814ee-161">A interface do usuário do complemento não é importante para este artigo.</span><span class="sxs-lookup"><span data-stu-id="814ee-161">The UI of the add-in is not important to this article.</span></span> <span data-ttu-id="814ee-162">Por exemplo, ele poderia ter um painel de tarefas com três caixas de texto, cada uma rotulada com um dos espaço reservados.</span><span class="sxs-lookup"><span data-stu-id="814ee-162">For example, it could have a task pane with three text boxes, each labeled with one of the placeholders.</span></span> <span data-ttu-id="814ee-163">O usuário insra um nome em cada caixa de texto e pressiona um **botão Substituir.**</span><span class="sxs-lookup"><span data-stu-id="814ee-163">The user enters a name in each text box and then presses a **Replace** button.</span></span> <span data-ttu-id="814ee-164">O manipulador do botão cria uma matriz que mapeia os nomes para os espaço reservados e substitui cada espaço reservado pelo nome atribuído.</span><span class="sxs-lookup"><span data-stu-id="814ee-164">The handler for the button creates an array that maps the names to the placeholders, and then replaces each placeholder with the assigned name.</span></span> 

<span data-ttu-id="814ee-165">Você não precisa realmente produzir um complemento com essa interface do usuário para experimentar o código.</span><span class="sxs-lookup"><span data-stu-id="814ee-165">You don't need to actually produce an add-in with this UI to experiment with the code.</span></span> <span data-ttu-id="814ee-166">Você pode usar a ferramenta [Script Lab para](../overview/explore-with-script-lab.md) protótipo do código importante.</span><span class="sxs-lookup"><span data-stu-id="814ee-166">You can use the [Script Lab tool](../overview/explore-with-script-lab.md) to prototype the important code.</span></span> <span data-ttu-id="814ee-167">Use a instrução de atribuição a seguir para criar a matriz de mapeamento.</span><span class="sxs-lookup"><span data-stu-id="814ee-167">Use the following assignment statement to create the mapping array.</span></span>

```javascript
const jobMapping = [
        { job: "{Coordinator}", person: "Sally" },
        { job: "{Deputy}", person: "Bob" },
        { job: "{Manager}", person: "Kim" }
    ];
```

<span data-ttu-id="814ee-168">O código a seguir mostra como você pode substituir cada espaço reservado por seu nome atribuído se você usou `context.sync` loops dentro.</span><span class="sxs-lookup"><span data-stu-id="814ee-168">The following code shows how you might replace each placeholder with its assigned name if you used `context.sync` inside loops.</span></span>

```javascript
Word.run(async (context) => {

    for (let i = 0; i < jobMapping.length; i++) {
      let options = Word.SearchOptions.newObject(context);
      options.matchWildCards = false;
      let searchResults = context.document.body.search(jobMapping[i].job, options);
      searchResults.load('items');

      await context.sync(); 

      for (let j = 0; j < searchResults.items.length; j++) {
        searchResults.items[j].insertText(jobMapping[i].person, Word.InsertLocation.replace);

        await context.sync();
      }
    }
});
```

<span data-ttu-id="814ee-169">No código anterior, há um loop externo e interno.</span><span class="sxs-lookup"><span data-stu-id="814ee-169">In the preceding code, there is an outer and an inner loop.</span></span> <span data-ttu-id="814ee-170">Cada um deles contém um `context.sync` .</span><span class="sxs-lookup"><span data-stu-id="814ee-170">Each of them contains a `context.sync`.</span></span> <span data-ttu-id="814ee-171">Com base no primeiro trecho de código deste artigo, você provavelmente verá que o loop interno pode simplesmente ser movido `context.sync` após o loop interno.</span><span class="sxs-lookup"><span data-stu-id="814ee-171">Based on the very first code snippet in this article, you probably see that the `context.sync` in the inner loop can simply be moved after the inner loop.</span></span> <span data-ttu-id="814ee-172">Mas isso ainda deixaria o código com `context.sync` um (dois deles, na verdade) no loop externo.</span><span class="sxs-lookup"><span data-stu-id="814ee-172">But that would still leave the code with a `context.sync` (two of them actually) in the outer loop.</span></span> <span data-ttu-id="814ee-173">O código a seguir mostra como você pode `context.sync` remover dos loops.</span><span class="sxs-lookup"><span data-stu-id="814ee-173">The following code shows how you can remove `context.sync` from the loops.</span></span> <span data-ttu-id="814ee-174">Discutiremos o código abaixo.</span><span class="sxs-lookup"><span data-stu-id="814ee-174">We discuss the code below.</span></span>

```javascript
Word.run(async (context) => {

    const allSearchResults = [];
    for (let i = 0; i < jobMapping.length; i++) {
      let options = Word.SearchOptions.newObject(context);
      options.matchWildCards = false;
      let searchResults = context.document.body.search(jobMapping[i].job, options);
      searchResults.load('items');
      let correlatedSearchResult = {
        rangesMatchingJob: searchResults,
        personAssignedToJob: jobMapping[i].person
      }
      allSearchResults.push(correlatedSearchResult);
    }

    await context.sync()

    for (let i = 0; i < allSearchResults.length; i++) {
      let correlatedObject = allSearchResults[i];

      for (let j = 0; j < correlatedObject.rangesMatchingJob.items.length; j++) {
        let targetRange = correlatedObject.rangesMatchingJob.items[j];
        let name = correlatedObject.personAssignedToJob;
        targetRange.insertText(name, Word.InsertLocation.replace);
      }
    }

    await context.sync();
});
```

<span data-ttu-id="814ee-175">Observe que o código usa o padrão de loop dividido:</span><span class="sxs-lookup"><span data-stu-id="814ee-175">Note the code uses the split loop pattern:</span></span>

- <span data-ttu-id="814ee-176">O loop externo do exemplo anterior foi dividido em dois.</span><span class="sxs-lookup"><span data-stu-id="814ee-176">The outer loop from the preceding example has been split into two.</span></span> <span data-ttu-id="814ee-177">(O segundo loop tem um loop interno, que é esperado porque o código está iterando sobre um conjunto de trabalhos (ou espaço reservados) e dentro desse conjunto ele está iterando sobre os intervalos correspondentes.)</span><span class="sxs-lookup"><span data-stu-id="814ee-177">(The second loop has an inner loop, which is expected because the code is iterating over a set of jobs (or placeholders) and within that set it is iterating over the matching ranges.)</span></span>
- <span data-ttu-id="814ee-178">Há um após `context.sync` cada loop principal, mas `context.sync` não dentro de qualquer loop.</span><span class="sxs-lookup"><span data-stu-id="814ee-178">There is a `context.sync` after each major loop, but no `context.sync` inside any loop.</span></span>
- <span data-ttu-id="814ee-179">O segundo loop principal itera através de uma matriz criada no primeiro loop.</span><span class="sxs-lookup"><span data-stu-id="814ee-179">The second major loop iterates through an array that is created in the first loop.</span></span>

<span data-ttu-id="814ee-180">Mas a matriz criada no  primeiro loop não contém apenas um objeto Office como o primeiro loop fez na seção Ler valores do documento com o padrão de [loop dividido.](#reading-values-from-the-document-with-the-split-loop-pattern)</span><span class="sxs-lookup"><span data-stu-id="814ee-180">But the array created in the first loop does *not* contain only an Office object as the first loop did in the section [Reading values from the document with the split loop pattern](#reading-values-from-the-document-with-the-split-loop-pattern).</span></span> <span data-ttu-id="814ee-181">Isso acontece porque algumas das informações necessárias para processar os objetos Intervalo do Word não estão nos objetos Range em si, mas vêm da `jobMapping` matriz.</span><span class="sxs-lookup"><span data-stu-id="814ee-181">This is because some of the information needed to process the Word Range objects is not in the Range objects themselves but instead comes from the `jobMapping` array.</span></span>

<span data-ttu-id="814ee-182">Portanto, os objetos na matriz criada no primeiro loop são objetos personalizados que têm duas propriedades.</span><span class="sxs-lookup"><span data-stu-id="814ee-182">So, the objects in the array created in the first loop are custom objects that have two properties.</span></span> <span data-ttu-id="814ee-183">O primeiro é uma matriz de Intervalos do Word que combinam com um título de trabalho específico (ou seja, uma cadeia de caracteres de espaço reservado) e a segunda é uma cadeia de caracteres que fornece o nome da pessoa atribuída ao trabalho.</span><span class="sxs-lookup"><span data-stu-id="814ee-183">The first is an array of Word Ranges that match a specific job title (that is, a placeholder string) and the second is a string that provides the name of the person assigned to the job.</span></span> <span data-ttu-id="814ee-184">Isso torna o loop final fácil de gravar e fácil de ler porque todas as informações necessárias para processar um determinado intervalo estão contidas no mesmo objeto personalizado que contém o intervalo.</span><span class="sxs-lookup"><span data-stu-id="814ee-184">This makes the final loop easy to write and easy to read because all of the information needed to process a given range is contained in the same custom object that contains the range.</span></span> <span data-ttu-id="814ee-185">O nome que deve substituir _**correlacionadoObject**.rangesMatchingJob.items[j]_ é a outra propriedade do mesmo objeto: _**correlatedObject**.personAssignedToJob_.</span><span class="sxs-lookup"><span data-stu-id="814ee-185">The name that should replace _**correlatedObject**.rangesMatchingJob.items[j]_ is the other property of the same object: _**correlatedObject**.personAssignedToJob_.</span></span>

<span data-ttu-id="814ee-186">Chamamos essa variação do padrão de loop dividido do **padrão de objetos correlacionados.**</span><span class="sxs-lookup"><span data-stu-id="814ee-186">We call this variation of the split loop pattern the **correlated objects** pattern.</span></span> <span data-ttu-id="814ee-187">A ideia geral é que o primeiro loop cria uma matriz de objetos personalizados.</span><span class="sxs-lookup"><span data-stu-id="814ee-187">The general idea is that the first loop creates an array of custom objects.</span></span> <span data-ttu-id="814ee-188">Cada objeto tem uma propriedade cujo valor é um dos itens em um objeto Office coleção Office (ou uma matriz desses itens).</span><span class="sxs-lookup"><span data-stu-id="814ee-188">Each object has a property whose value is one of the items in an Office collection object (or an array of such items).</span></span> <span data-ttu-id="814ee-189">O objeto personalizado tem outras propriedades, cada uma delas fornece informações necessárias para processar os objetos Office no loop final.</span><span class="sxs-lookup"><span data-stu-id="814ee-189">The custom object has other properties, each of which provides information needed to process the Office objects in the final loop.</span></span> <span data-ttu-id="814ee-190">Consulte a seção [Outros exemplos desses](#other-examples-of-these-patterns) padrões para um link para um exemplo em que o objeto de correlação personalizado tem mais de duas propriedades.</span><span class="sxs-lookup"><span data-stu-id="814ee-190">See the section [Other examples of these patterns](#other-examples-of-these-patterns) for a link to an example where the custom correlating object has more than two properties.</span></span>

<span data-ttu-id="814ee-191">Uma outra advertência: às vezes, é necessário mais de um loop apenas para criar a matriz de objetos de correlação personalizados.</span><span class="sxs-lookup"><span data-stu-id="814ee-191">One further caveat: sometimes it takes more than one loop just to create the array of custom correlating objects.</span></span> <span data-ttu-id="814ee-192">Isso pode acontecer se você precisar ler uma propriedade de cada membro de um objeto da coleção Office apenas para coletar informações que serão usadas para processar outro objeto de coleção.</span><span class="sxs-lookup"><span data-stu-id="814ee-192">This can happen if you need to read a property of each member of one Office collection object just to gather information that will be used to process another collection object.</span></span> <span data-ttu-id="814ee-193">(Por exemplo, seu código precisa ler os títulos de todas as colunas em uma tabela Excel porque o seu complemento aplicará um formato numérico às células de algumas colunas com base no título dessa coluna.) Mas você sempre pode manter `context.sync` o s entre os loops, em vez de em um loop.</span><span class="sxs-lookup"><span data-stu-id="814ee-193">(For example, your code needs to read the titles of all the columns in an Excel table because your add-in is going to apply a number format to the cells of some columns based on that column's title.) But you can always keep the `context.sync`s between the loops, rather than in a loop.</span></span> <span data-ttu-id="814ee-194">Consulte a seção [Outros exemplos desses padrões](#other-examples-of-these-patterns) para um exemplo.</span><span class="sxs-lookup"><span data-stu-id="814ee-194">See the section [Other examples of these patterns](#other-examples-of-these-patterns) for an example.</span></span>

## <a name="other-examples-of-these-patterns"></a><span data-ttu-id="814ee-195">Outros exemplos desses padrões</span><span class="sxs-lookup"><span data-stu-id="814ee-195">Other examples of these patterns</span></span>

- <span data-ttu-id="814ee-196">Para obter um exemplo muito simples para Excel que usa loops, consulte a resposta aceita para esta pergunta Stack Overflow: É possível enfileir mais de um `Array.forEach` [context.load antes de context.sync?](https://stackoverflow.com/questions/44459604/is-it-possible-to-queue-more-than-one-context-load-before-context-sync)</span><span class="sxs-lookup"><span data-stu-id="814ee-196">For a very simple example for Excel that uses `Array.forEach` loops, see the accepted answer to this Stack Overflow question: [Is it possible to queue more than one context.load before context.sync?](https://stackoverflow.com/questions/44459604/is-it-possible-to-queue-more-than-one-context-load-before-context-sync)</span></span>
- <span data-ttu-id="814ee-197">Para um exemplo simples para o Word que usa loops e não usa sintaxe, consulte a resposta aceita para esta pergunta `Array.forEach` `async` / `await` Stack Overflow: [Iterating over](https://stackoverflow.com/questions/58422113/iterating-over-all-paragraphs-with-content-controls-with-office-javascript-api)all paragraphs with content controls with Office JavaScript API .</span><span class="sxs-lookup"><span data-stu-id="814ee-197">For a simple example for Word that uses `Array.forEach` loops and doesn't use `async`/`await` syntax, see the accepted answer to this Stack Overflow question: [Iterating over all paragraphs with content controls with Office JavaScript API](https://stackoverflow.com/questions/58422113/iterating-over-all-paragraphs-with-content-controls-with-office-javascript-api).</span></span>
- <span data-ttu-id="814ee-198">Para ver um exemplo do Word escrito em TypeScript, consulte o exemplo [do Word Add-in Angular2 Style Checker](https://github.com/OfficeDev/Word-Add-in-Angular2-StyleChecker), especialmente o arquivo [word.document.service.ts](https://github.com/OfficeDev/Word-Add-in-Angular2-StyleChecker/blob/master/app/services/word-document/word.document.service.ts).</span><span class="sxs-lookup"><span data-stu-id="814ee-198">For an example for Word that is written in TypeScript, see the sample [Word Add-in Angular2 Style Checker](https://github.com/OfficeDev/Word-Add-in-Angular2-StyleChecker), especially the file [word.document.service.ts](https://github.com/OfficeDev/Word-Add-in-Angular2-StyleChecker/blob/master/app/services/word-document/word.document.service.ts).</span></span> <span data-ttu-id="814ee-199">Ele tem uma mistura de `for` `Array.forEach` e loops.</span><span class="sxs-lookup"><span data-stu-id="814ee-199">It has a mixture of `for` and `Array.forEach` loops.</span></span>
- <span data-ttu-id="814ee-200">Para um exemplo avançado do Word, importe [esse gist](https://gist.github.com/9c5a803e52480ec7f00bb3224292e0ab) para a [Script Lab ferramenta](../overview/explore-with-script-lab.md).</span><span class="sxs-lookup"><span data-stu-id="814ee-200">For an advanced Word sample, import [this gist](https://gist.github.com/9c5a803e52480ec7f00bb3224292e0ab) into the [Script Lab tool](../overview/explore-with-script-lab.md).</span></span> <span data-ttu-id="814ee-201">Para contexto ao usar o gist, consulte a resposta aceita para a pergunta Stack Overflow [Document not in sync after replace text](https://stackoverflow.com/questions/48227941/document-not-in-sync-after-replace-text).</span><span class="sxs-lookup"><span data-stu-id="814ee-201">For context in using the gist, see the accepted answer to the Stack Overflow question [Document not in sync after replace text](https://stackoverflow.com/questions/48227941/document-not-in-sync-after-replace-text).</span></span> <span data-ttu-id="814ee-202">Este exemplo cria um tipo de objeto de correlação personalizado que tem três propriedades.</span><span class="sxs-lookup"><span data-stu-id="814ee-202">This sample creates a custom correlating object type that has three properties.</span></span> <span data-ttu-id="814ee-203">Ele usa um total de três loops para construir a matriz de objetos correlacionados e mais dois loops para fazer o processamento final.</span><span class="sxs-lookup"><span data-stu-id="814ee-203">It uses a total of three loops to construct the array of correlated objects, and two more loops to do the final processing.</span></span> <span data-ttu-id="814ee-204">Há uma mistura de `for` e `Array.forEach` loops.</span><span class="sxs-lookup"><span data-stu-id="814ee-204">There are a mixture of `for` and `Array.forEach` loops.</span></span>
- <span data-ttu-id="814ee-205">Embora não seja estritamente um exemplo do loop dividido ou dos padrões de objetos correlacionados, há uma amostra de Excel avançada que mostra como converter um conjunto de valores de célula em outras moedas com apenas um `context.sync` único .</span><span class="sxs-lookup"><span data-stu-id="814ee-205">Although not strictly an example of the split loop or correlated objects patterns, there is an advanced Excel sample that shows how to convert a set of cell values to other currencies with just a single `context.sync`.</span></span> <span data-ttu-id="814ee-206">Para experimentar, abra a ferramenta [Script Lab e](../overview/explore-with-script-lab.md) navegue até o exemplo **Conversor de Moedas Conversor.**</span><span class="sxs-lookup"><span data-stu-id="814ee-206">To try it, open the [Script Lab tool](../overview/explore-with-script-lab.md) and navigate to the **Currency Converter** sample.</span></span>

## <a name="when-should-you-not-use-the-patterns-in-this-article"></a><span data-ttu-id="814ee-207">Quando você *não deve* usar os padrões neste artigo?</span><span class="sxs-lookup"><span data-stu-id="814ee-207">When should you *not* use the patterns in this article?</span></span>

<span data-ttu-id="814ee-208">Excel pode ler mais de 5 MB de dados em uma determinada chamada de `context.sync` .</span><span class="sxs-lookup"><span data-stu-id="814ee-208">Excel cannot read more than 5 MB of data in a given call of `context.sync`.</span></span> <span data-ttu-id="814ee-209">Se esse limite for excedido, será lançado um erro.</span><span class="sxs-lookup"><span data-stu-id="814ee-209">If this limit is exceeded, an error is thrown.</span></span> <span data-ttu-id="814ee-210">(Consulte a seção "Excel de Excel" dos limites de recursos e otimização de desempenho para Office [de Office para](resource-limits-and-performance-optimization.md#excel-add-ins) obter mais informações.) É muito raro que esse limite seja abordado, mas se houver uma chance de isso acontecer  com o seu complemento, seu código não deve carregar todos os dados em um único loop e seguir o loop com `context.sync` um .</span><span class="sxs-lookup"><span data-stu-id="814ee-210">(See the "Excel add-ins section" of [Resource limits and performance optimization for Office Add-ins](resource-limits-and-performance-optimization.md#excel-add-ins) for more information.) It's very rare that this limit is approached, but if there's a chance that this will happen with your add-in, then your code should *not* load all the data in a single loop and follow the loop with a `context.sync`.</span></span> <span data-ttu-id="814ee-211">Mas você ainda deve evitar ter uma `context.sync` em cada iteração de um loop sobre um objeto de coleção.</span><span class="sxs-lookup"><span data-stu-id="814ee-211">But you still should avoid having a `context.sync` in every iteration of a loop over a collection object.</span></span> <span data-ttu-id="814ee-212">Em vez disso, defina subconjuntos dos itens na coleção e loop sobre cada subconjunto, por sua vez, com um `context.sync` entre os loops.</span><span class="sxs-lookup"><span data-stu-id="814ee-212">Instead, define subsets of the items in the collection and loop over each subset in turn, with a `context.sync` between the loops.</span></span> <span data-ttu-id="814ee-213">Você pode estruturar isso com um loop externo que itera sobre os subconjuntos e contém o em cada `context.sync` uma dessas iterações externas.</span><span class="sxs-lookup"><span data-stu-id="814ee-213">You could structure this with an outer loop that iterates over the subsets and contains the `context.sync` in each of these outer iterations.</span></span>
