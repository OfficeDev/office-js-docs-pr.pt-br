---
ms.date: 1/29/2019
description: Autentica usuários usando as funções personalizadas no Excel.
title: Autenticação para funções personalizadas
ms.openlocfilehash: 0e42dbc93cb545660a8dbaae5bdb48724f3b7376
ms.sourcegitcommit: 33dcf099c6b3d249811580d67ee9b790c0fdccfb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/05/2019
ms.locfileid: "29745398"
---
# <a name="authentication"></a><span data-ttu-id="7844f-103">Autenticação</span><span class="sxs-lookup"><span data-stu-id="7844f-103">Authentication</span></span>

<span data-ttu-id="7844f-104">Em alguns cenários que sua função personalizada será necessário para autenticar o usuário para acessar recursos protegidos.</span><span class="sxs-lookup"><span data-stu-id="7844f-104">In some scenarios your custom function will need to authenticate the user in order to access protected resources.</span></span> <span data-ttu-id="7844f-105">Enquanto as funções personalizadas não exige um método específico de autenticação, você deve estar ciente de que funções personalizadas é executado em um tempo de execução separado do painel de tarefas e outros elementos de interface do usuário do seu suplemento.</span><span class="sxs-lookup"><span data-stu-id="7844f-105">While custom functions doesn't require a specific method of authentication, you should be aware that custom functions runs in a separate runtime from the task pane and other UI elements of your add-in.</span></span> <span data-ttu-id="7844f-106">Dessa forma, você precisará passar dados bidirecionalmente entre os dois tempos de execução usando o `AsyncStorage` objeto e a API de diálogo.</span><span class="sxs-lookup"><span data-stu-id="7844f-106">Because of this, you'll need to pass data back and forth between the two runtimes using the `AsyncStorage` object and the Dialog API.</span></span>
  
## <a name="asyncstorage-object"></a><span data-ttu-id="7844f-107">Objeto AsyncStorage</span><span class="sxs-lookup"><span data-stu-id="7844f-107">AsyncStorage object</span></span>

<span data-ttu-id="7844f-108">O tempo de execução de funções personalizadas não tem um `localStorage` objeto disponível na janela global, onde você pode armazenar dados normalmente.</span><span class="sxs-lookup"><span data-stu-id="7844f-108">The custom functions runtime doesn't have a `localStorage` object available on the global window, where you might typically store data.</span></span> <span data-ttu-id="7844f-109">Em vez disso, você deve compartilhar dados entre funções personalizadas e painéis de tarefas, usando [OfficeRuntime.AsyncStorage](https://docs.microsoft.com/javascript/api/office-runtime/officeruntime.asyncstorage) para definir e obter dados.</span><span class="sxs-lookup"><span data-stu-id="7844f-109">Instead, you should share data between custom functions and task panes, by using [OfficeRuntime.AsyncStorage](https://docs.microsoft.com/javascript/api/office-runtime/officeruntime.asyncstorage) to set and get data.</span></span> 

<span data-ttu-id="7844f-110">Além disso, há um benefício usando `AsyncStorage`; Ele usa um ambiente seguro segura para que seus dados não podem ser acessados por outros complementos.</span><span class="sxs-lookup"><span data-stu-id="7844f-110">Additionally, there is a benefit to using `AsyncStorage`; it uses a secure sandbox environment so that your data cannot be accessed by other add-ins.</span></span>  

### <a name="suggested-usage"></a><span data-ttu-id="7844f-111">Uso sugerido</span><span class="sxs-lookup"><span data-stu-id="7844f-111">Suggested usage</span></span>

<span data-ttu-id="7844f-112">Quando você precisa para autenticar a partir do painel de tarefas ou uma função personalizada, verifique AsyncStorage para ver se o token de acesso já foi adquirido.</span><span class="sxs-lookup"><span data-stu-id="7844f-112">When you need to authenticate either from the task pane or a custom function, check AsyncStorage to see if the access token was already acquired.</span></span> <span data-ttu-id="7844f-113">Caso contrário, use a caixa de diálogo API para autenticar o usuário, recupere o token de acesso e armazene o token no AsyncStorage para uso futuro.</span><span class="sxs-lookup"><span data-stu-id="7844f-113">If not, use the dialog API to authenticate the user, retrieve the access token, and then store the token in AsyncStorage for future use.</span></span>

## <a name="dialog-api"></a><span data-ttu-id="7844f-114">API de diálogo</span><span class="sxs-lookup"><span data-stu-id="7844f-114">Dialog API</span></span>

<span data-ttu-id="7844f-115">Se não existir um token, você deve usar a API de diálogo pedir ao usuário para entrar.</span><span class="sxs-lookup"><span data-stu-id="7844f-115">If a token doesn't exist, you should use the Dialog API to ask the user to sign in.</span></span> <span data-ttu-id="7844f-116">Depois que um usuário digita suas credenciais, o token de acesso resultantes pode ser armazenado em `AsyncStorage`.</span><span class="sxs-lookup"><span data-stu-id="7844f-116">After a user enters their credentials, the resulting access token can be stored in `AsyncStorage`.</span></span>

> [!NOTE]
> <span data-ttu-id="7844f-117">O tempo de execução de funções personalizadas usa um objeto de diálogo que é ligeiramente diferente do objeto Dialog no runtime usado pelo painéis de tarefas.</span><span class="sxs-lookup"><span data-stu-id="7844f-117">The custom functions runtime uses a Dialog object that is slightly different from the Dialog object in the runtime used by task panes.</span></span> <span data-ttu-id="7844f-118">Estiver ambos conhecidos como "Diálogo API", mas use `Officeruntime.Dialog` para autenticar usuários em tempo de execução de funções personalizadas.</span><span class="sxs-lookup"><span data-stu-id="7844f-118">They're both referred to as the "Dialog API", but use `Officeruntime.Dialog` to authenticate users in the custom functions runtime.</span></span>

<span data-ttu-id="7844f-119">Para obter informações sobre como usar o `OfficeRuntime.Dialog`, consulte o [tempo de execução de funções personalizadas](https://docs.microsoft.com/en-us/office/dev/add-ins/excel/custom-functions-runtime?view=office-js#displaying-a-dialog-box).</span><span class="sxs-lookup"><span data-stu-id="7844f-119">For information on how to use the `OfficeRuntime.Dialog`, see [Custom Functions runtime](https://docs.microsoft.com/en-us/office/dev/add-ins/excel/custom-functions-runtime?view=office-js#displaying-a-dialog-box).</span></span>

<span data-ttu-id="7844f-120">Quando envisioning o processo de autenticação inteira como um todo, talvez seja útil pensar o painel de tarefas e elementos de interface do usuário do seu suplemento e custom funciona partes de seu suplemento como entidades separadas que podem se comunicar entre si por meio de `AsyncStorage`.</span><span class="sxs-lookup"><span data-stu-id="7844f-120">When envisioning the entire authentication process as a whole, it might be helpful to think of the task pane and UI elements of your add-in and the custom functions portions of your add-in as separate entities which can communicate with each other through `AsyncStorage`.</span></span>

<span data-ttu-id="7844f-121">O diagrama a seguir descreve esse processo básico.</span><span class="sxs-lookup"><span data-stu-id="7844f-121">The following diagram outlines this basic process.</span></span> <span data-ttu-id="7844f-122">Observe que a linha pontilhada indica que enquanto executam ações separadas, funções personalizadas e painel de tarefas do seu suplemento fazem parte do seu suplemento como um todo.</span><span class="sxs-lookup"><span data-stu-id="7844f-122">Note that the dotted line indicates that while they perform separate actions, custom functions and your add-in's task pane are both parts of your add-in as a whole.</span></span>

1. <span data-ttu-id="7844f-123">Você emite uma chamada de função personalizada de uma célula em uma planilha do Excel.</span><span class="sxs-lookup"><span data-stu-id="7844f-123">You issue a custom function call from a cell in an Excel workbook.</span></span>
2. <span data-ttu-id="7844f-124">A função personalizada usa `Officeruntime.Dialog` passar suas credenciais de usuário para um site.</span><span class="sxs-lookup"><span data-stu-id="7844f-124">The custom function uses `Officeruntime.Dialog` to pass your user credentials to a website.</span></span>
3. <span data-ttu-id="7844f-125">Este site, em seguida, retorna um token de acesso para a função personalizada.</span><span class="sxs-lookup"><span data-stu-id="7844f-125">This website then returns an access token to the custom function.</span></span>
4. <span data-ttu-id="7844f-126">Sua função personalizada define este token de acesso para o `AsyncStorage`.</span><span class="sxs-lookup"><span data-stu-id="7844f-126">Your custom function then sets this access token to the `AsyncStorage`.</span></span>
5. <span data-ttu-id="7844f-127">Painel de tarefas do suplemento acessa o token de `AsyncStorage`.</span><span class="sxs-lookup"><span data-stu-id="7844f-127">Your add-in's task pane accesses the token from `AsyncStorage`.</span></span>

<span data-ttu-id="7844f-128">![Diagrama de funções personalizadas, OfficeRuntime e painéis de tarefas trabalhando juntos.] (../images/Authdiagram.png "Diagrama de autenticação.")</span><span class="sxs-lookup"><span data-stu-id="7844f-128">![Diagram of custom functions, OfficeRuntime, and task panes working together.](../images/Authdiagram.png "Authentication diagram.")</span></span>

## <a name="general-guidance"></a><span data-ttu-id="7844f-129">Diretrizes gerais</span><span class="sxs-lookup"><span data-stu-id="7844f-129">General guidance</span></span>

<span data-ttu-id="7844f-130">Suplementos do Office são baseados na web e você pode usar qualquer técnica de autenticação da web.</span><span class="sxs-lookup"><span data-stu-id="7844f-130">Office Add-ins are web-based and you can use any web authentication technique.</span></span> <span data-ttu-id="7844f-131">Não há nenhum padrão específico ou método que você deve seguir para implementar sua própria autenticação com funções personalizadas.</span><span class="sxs-lookup"><span data-stu-id="7844f-131">There is no particular pattern or method you must follow to implement your own authentication with custom functions.</span></span> <span data-ttu-id="7844f-132">Você poderá consultar a documentação sobre vários padrões de autenticação, começando com [Este artigo sobre como autorizar via serviços externos](https://docs.microsoft.com/en-us/office/dev/add-ins/develop/auth-external-add-ins?view=office-js).</span><span class="sxs-lookup"><span data-stu-id="7844f-132">You may wish to consult the documentation about various authentication patterns, starting with [this article about authorizing via external services](https://docs.microsoft.com/en-us/office/dev/add-ins/develop/auth-external-add-ins?view=office-js).</span></span>  

<span data-ttu-id="7844f-133">Evite o uso dos seguintes locais para armazenar dados ao desenvolver funções personalizadas:</span><span class="sxs-lookup"><span data-stu-id="7844f-133">Avoid using the following locations to store data when developing custom functions:</span></span>  

- <span data-ttu-id="7844f-134">`localStorage`: Funções personalizadas não têm acesso ao global `window` objeto e, portanto, não têm acesso aos dados armazenados em `localStorage`.</span><span class="sxs-lookup"><span data-stu-id="7844f-134">`localStorage`: Custom functions do not have access to the global `window` object and therefore have no access to data     stored in `localStorage`.</span></span>
- <span data-ttu-id="7844f-135">`Office.context.document.settings`: Este local não é seguro e informações podem ser extraídas pela pessoa que usar o suplemento.</span><span class="sxs-lookup"><span data-stu-id="7844f-135">`Office.context.document.settings`:  This location is not secure and information can be extracted by anyone using the     add-in.</span></span>

## <a name="see-also"></a><span data-ttu-id="7844f-136">Confira também</span><span class="sxs-lookup"><span data-stu-id="7844f-136">See also</span></span>

* [<span data-ttu-id="7844f-137">Metadados de funções personalizadas</span><span class="sxs-lookup"><span data-stu-id="7844f-137">Custom functions metadata</span></span>](custom-functions-json.md)
* [<span data-ttu-id="7844f-138">Tempo de execução de funções personalizadas do Excel</span><span class="sxs-lookup"><span data-stu-id="7844f-138">Runtime for Excel custom functions</span></span>](custom-functions-runtime.md)
* <span data-ttu-id="7844f-139">[Práticas recomendadas de funções personalizadas](custom-functions-best-practices.md).</span><span class="sxs-lookup"><span data-stu-id="7844f-139">[Custom functions best practices](custom-functions-best-practices.md)</span></span>
* [<span data-ttu-id="7844f-140">Tutorial de funções personalizadas do Excel</span><span class="sxs-lookup"><span data-stu-id="7844f-140">Excel custom functions tutorial</span></span>](excel-tutorial-custom-functions.md)
